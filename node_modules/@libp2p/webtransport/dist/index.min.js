(function (root, factory) {(typeof module === 'object' && module.exports) ? module.exports = factory() : root.Libp2PWebtransport = factory()}(typeof self !== 'undefined' ? self : this, function () {
"use strict";var Libp2PWebtransport=(()=>{var no=Object.defineProperty;var Iu=Object.getOwnPropertyDescriptor;var Lu=Object.getOwnPropertyNames;var Tu=Object.prototype.hasOwnProperty;var St=(r,t)=>{for(var e in t)no(r,e,{get:t[e],enumerable:!0})},_u=(r,t,e,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Lu(t))!Tu.call(r,o)&&o!==e&&no(r,o,{get:()=>t[o],enumerable:!(n=Iu(t,o))||n.enumerable});return r};var Cu=r=>_u(no({},"__esModule",{value:!0}),r);var Rd={};St(Rd,{webTransport:()=>Ud});var oo=Symbol.for("@libp2p/peer-id");var Di=Symbol.for("@libp2p/transport");var Ni;(function(r){r[r.FATAL_ALL=0]="FATAL_ALL",r[r.NO_FATAL=1]="NO_FATAL"})(Ni||(Ni={}));var Vr=class extends Error{static name="UnexpectedPeerError";constructor(t="Unexpected Peer"){super(t),this.name="UnexpectedPeerError"}},Fr=class extends Error{static name="InvalidCryptoExchangeError";constructor(t="Invalid crypto exchange"){super(t),this.name="InvalidCryptoExchangeError"}},yt=class extends Error{static name="InvalidParametersError";constructor(t="Invalid parameters"){super(t),this.name="InvalidParametersError"}},Oe=class extends Error{static name="InvalidPublicKeyError";constructor(t="Invalid public key"){super(t),this.name="InvalidPublicKeyError"}};var zr=class extends Error{static name="StreamResetError";constructor(t="The stream has been reset"){super(t),this.name="StreamResetError"}},Gr=class extends Error{static name="StreamStateError";constructor(t="The stream is in an invalid state"){super(t),this.name="StreamStateError"}};var Wr=class extends Error{static name="InvalidMultiaddrError";constructor(t="Invalid multiaddr"){super(t),this.name="InvalidMultiaddrError"}},$r=class extends Error{static name="InvalidCIDError";constructor(t="Invalid CID"){super(t),this.name="InvalidCIDError"}},Zr=class extends Error{static name="InvalidMultihashError";constructor(t="Invalid Multihash"){super(t),this.name="InvalidMultihashError"}};var be=class extends Error{static name="UnsupportedKeyTypeError";constructor(t="Unsupported key type"){super(t),this.name="UnsupportedKeyTypeError"}};var jr=Symbol.for("@libp2p/service-capabilities"),Kd=Symbol.for("@libp2p/service-dependencies");var uo={};St(uo,{base58btc:()=>et,base58flickr:()=>Du});var ip=new Uint8Array(0);function Ki(r,t){if(r===t)return!0;if(r.byteLength!==t.byteLength)return!1;for(let e=0;e<r.byteLength;e++)if(r[e]!==t[e])return!1;return!0}function jt(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function Oi(r){return new TextEncoder().encode(r)}function Mi(r){return new TextDecoder().decode(r)}function Uu(r,t){if(r.length>=255)throw new TypeError("Alphabet too long");for(var e=new Uint8Array(256),n=0;n<e.length;n++)e[n]=255;for(var o=0;o<r.length;o++){var s=r.charAt(o),i=s.charCodeAt(0);if(e[i]!==255)throw new TypeError(s+" is ambiguous");e[i]=o}var a=r.length,c=r.charAt(0),f=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function l(w){if(w instanceof Uint8Array||(ArrayBuffer.isView(w)?w=new Uint8Array(w.buffer,w.byteOffset,w.byteLength):Array.isArray(w)&&(w=Uint8Array.from(w))),!(w instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(w.length===0)return"";for(var m=0,h=0,x=0,E=w.length;x!==E&&w[x]===0;)x++,m++;for(var p=(E-x)*u+1>>>0,I=new Uint8Array(p);x!==E;){for(var U=w[x],C=0,T=p-1;(U!==0||C<h)&&T!==-1;T--,C++)U+=256*I[T]>>>0,I[T]=U%a>>>0,U=U/a>>>0;if(U!==0)throw new Error("Non-zero carry");h=C,x++}for(var _=p-h;_!==p&&I[_]===0;)_++;for(var B=c.repeat(m);_<p;++_)B+=r.charAt(I[_]);return B}function d(w){if(typeof w!="string")throw new TypeError("Expected String");if(w.length===0)return new Uint8Array;var m=0;if(w[m]!==" "){for(var h=0,x=0;w[m]===c;)h++,m++;for(var E=(w.length-m)*f+1>>>0,p=new Uint8Array(E);w[m];){var I=e[w.charCodeAt(m)];if(I===255)return;for(var U=0,C=E-1;(I!==0||U<x)&&C!==-1;C--,U++)I+=a*p[C]>>>0,p[C]=I%256>>>0,I=I/256>>>0;if(I!==0)throw new Error("Non-zero carry");x=U,m++}if(w[m]!==" "){for(var T=E-x;T!==E&&p[T]===0;)T++;for(var _=new Uint8Array(h+(E-T)),B=h;T!==E;)_[B++]=p[T++];return _}}}function g(w){var m=d(w);if(m)return m;throw new Error(`Non-${t} character`)}return{encode:l,decodeUnsafe:d,decode:g}}var Ru=Uu,Pu=Ru,qi=Pu;var so=class{name;prefix;baseEncode;constructor(t,e,n){this.name=t,this.prefix=e,this.baseEncode=n}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}},io=class{name;prefix;baseDecode;prefixCodePoint;constructor(t,e,n){this.name=t,this.prefix=e;let o=e.codePointAt(0);if(o===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=o,this.baseDecode=n}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return Vi(this,t)}},ao=class{decoders;constructor(t){this.decoders=t}or(t){return Vi(this,t)}decode(t){let e=t[0],n=this.decoders[e];if(n!=null)return n.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function Vi(r,t){return new ao({...r.decoders??{[r.prefix]:r},...t.decoders??{[t.prefix]:t}})}var co=class{name;prefix;baseEncode;baseDecode;encoder;decoder;constructor(t,e,n,o){this.name=t,this.prefix=e,this.baseEncode=n,this.baseDecode=o,this.encoder=new so(t,e,n),this.decoder=new io(t,e,o)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}};function Me({name:r,prefix:t,encode:e,decode:n}){return new co(r,t,e,n)}function ce({name:r,prefix:t,alphabet:e}){let{encode:n,decode:o}=qi(e,r);return Me({prefix:t,name:r,encode:n,decode:s=>jt(o(s))})}function ku(r,t,e,n){let o={};for(let u=0;u<t.length;++u)o[t[u]]=u;let s=r.length;for(;r[s-1]==="=";)--s;let i=new Uint8Array(s*e/8|0),a=0,c=0,f=0;for(let u=0;u<s;++u){let l=o[r[u]];if(l===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<e|l,a+=e,a>=8&&(a-=8,i[f++]=255&c>>a)}if(a>=e||(255&c<<8-a)!==0)throw new SyntaxError("Unexpected end of data");return i}function Nu(r,t,e){let n=t[t.length-1]==="=",o=(1<<e)-1,s="",i=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],i+=8;i>e;)i-=e,s+=t[o&a>>i];if(i!==0&&(s+=t[o&a<<e-i]),n)for(;(s.length*e&7)!==0;)s+="=";return s}function ut({name:r,prefix:t,bitsPerChar:e,alphabet:n}){return Me({prefix:t,name:r,encode(o){return Nu(o,n,e)},decode(o){return ku(o,n,e,r)}})}var et=ce({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Du=ce({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var fo={};St(fo,{base32:()=>Xt,base32hex:()=>Hu,base32hexpad:()=>Vu,base32hexpadupper:()=>Fu,base32hexupper:()=>qu,base32pad:()=>Ou,base32padupper:()=>Mu,base32upper:()=>Ku,base32z:()=>zu});var Xt=ut({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Ku=ut({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Ou=ut({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Mu=ut({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Hu=ut({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),qu=ut({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Vu=ut({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Fu=ut({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),zu=ut({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var lo={};St(lo,{base36:()=>cr,base36upper:()=>Gu});var cr=ce({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Gu=ce({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var zt={};St(zt,{Digest:()=>Ee,create:()=>kt,decode:()=>ue,equals:()=>po,hasCode:()=>lf});var Wu=Gi,Fi=128,$u=127,Zu=~$u,ju=Math.pow(2,31);function Gi(r,t,e){t=t||[],e=e||0;for(var n=e;r>=ju;)t[e++]=r&255|Fi,r/=128;for(;r&Zu;)t[e++]=r&255|Fi,r>>>=7;return t[e]=r|0,Gi.bytes=e-n+1,t}var Xu=ho,Yu=128,zi=127;function ho(r,n){var e=0,n=n||0,o=0,s=n,i,a=r.length;do{if(s>=a)throw ho.bytes=0,new RangeError("Could not decode varint");i=r[s++],e+=o<28?(i&zi)<<o:(i&zi)*Math.pow(2,o),o+=7}while(i>=Yu);return ho.bytes=s-n,e}var Ju=Math.pow(2,7),Qu=Math.pow(2,14),tf=Math.pow(2,21),ef=Math.pow(2,28),rf=Math.pow(2,35),nf=Math.pow(2,42),of=Math.pow(2,49),sf=Math.pow(2,56),af=Math.pow(2,63),cf=function(r){return r<Ju?1:r<Qu?2:r<tf?3:r<ef?4:r<rf?5:r<nf?6:r<of?7:r<sf?8:r<af?9:10},uf={encode:Wu,decode:Xu,encodingLength:cf},ff=uf,ur=ff;function fr(r,t=0){return[ur.decode(r,t),ur.decode.bytes]}function He(r,t,e=0){return ur.encode(r,t,e),t}function qe(r){return ur.encodingLength(r)}function kt(r,t){let e=t.byteLength,n=qe(r),o=n+qe(e),s=new Uint8Array(o+e);return He(r,s,0),He(e,s,n),s.set(t,o),new Ee(r,e,t,s)}function ue(r){let t=jt(r),[e,n]=fr(t),[o,s]=fr(t.subarray(n)),i=t.subarray(n+s);if(i.byteLength!==o)throw new Error("Incorrect length");return new Ee(e,o,i,t)}function po(r,t){if(r===t)return!0;{let e=t;return r.code===e.code&&r.size===e.size&&e.bytes instanceof Uint8Array&&Ki(r.bytes,e.bytes)}}var Ee=class{code;size;digest;bytes;constructor(t,e,n,o){this.code=t,this.size=e,this.digest=n,this.bytes=o}};function lf(r,t){return r.code===t}function Wi(r,t){let{bytes:e,version:n}=r;switch(n){case 0:return df(e,mo(r),t??et.encoder);default:return pf(e,mo(r),t??Xt.encoder)}}var $i=new WeakMap;function mo(r){let t=$i.get(r);if(t==null){let e=new Map;return $i.set(r,e),e}return t}var lt=class r{code;version;multihash;bytes;"/";constructor(t,e,n,o){this.code=e,this.version=t,this.multihash=n,this.bytes=o,this["/"]=o}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{let{code:t,multihash:e}=this;if(t!==lr)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(e.code!==mf)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return r.createV0(e)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{let{code:t,digest:e}=this.multihash,n=kt(t,e);return r.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(t){return r.equals(this,t)}static equals(t,e){let n=e;return n!=null&&t.code===n.code&&t.version===n.version&&po(t.multihash,n.multihash)}toString(t){return Wi(this,t)}toJSON(){return{"/":Wi(this)}}link(){return this}[Symbol.toStringTag]="CID";[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(t){if(t==null)return null;let e=t;if(e instanceof r)return e;if(e["/"]!=null&&e["/"]===e.bytes||e.asCID===e){let{version:n,code:o,multihash:s,bytes:i}=e;return new r(n,o,s,i??Zi(n,o,s.bytes))}else if(e[yf]===!0){let{version:n,multihash:o,code:s}=e,i=ue(o);return r.create(n,s,i)}else return null}static create(t,e,n){if(typeof e!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(t){case 0:{if(e!==lr)throw new Error(`Version 0 CID must use dag-pb (code: ${lr}) block encoding`);return new r(t,e,n,n.bytes)}case 1:{let o=Zi(t,e,n.bytes);return new r(t,e,n,o)}default:throw new Error("Invalid version")}}static createV0(t){return r.create(0,lr,t)}static createV1(t,e){return r.create(1,t,e)}static decode(t){let[e,n]=r.decodeFirst(t);if(n.length!==0)throw new Error("Incorrect length");return e}static decodeFirst(t){let e=r.inspectBytes(t),n=e.size-e.multihashSize,o=jt(t.subarray(n,n+e.multihashSize));if(o.byteLength!==e.multihashSize)throw new Error("Incorrect length");let s=o.subarray(e.multihashSize-e.digestSize),i=new Ee(e.multihashCode,e.digestSize,s,o);return[e.version===0?r.createV0(i):r.createV1(e.codec,i),t.subarray(e.size)]}static inspectBytes(t){let e=0,n=()=>{let[l,d]=fr(t.subarray(e));return e+=d,l},o=n(),s=lr;if(o===18?(o=0,e=0):s=n(),o!==0&&o!==1)throw new RangeError(`Invalid CID version ${o}`);let i=e,a=n(),c=n(),f=e+c,u=f-i;return{version:o,codec:s,multihashCode:a,digestSize:c,multihashSize:u,size:f}}static parse(t,e){let[n,o]=hf(t,e),s=r.decode(o);if(s.version===0&&t[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return mo(s).set(n,t),s}};function hf(r,t){switch(r[0]){case"Q":{let e=t??et;return[et.prefix,e.decode(`${et.prefix}${r}`)]}case et.prefix:{let e=t??et;return[et.prefix,e.decode(r)]}case Xt.prefix:{let e=t??Xt;return[Xt.prefix,e.decode(r)]}case cr.prefix:{let e=t??cr;return[cr.prefix,e.decode(r)]}default:{if(t==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],t.decode(r)]}}}function df(r,t,e){let{prefix:n}=e;if(n!==et.prefix)throw Error(`Cannot string encode V0 in ${e.name} encoding`);let o=t.get(n);if(o==null){let s=e.encode(r).slice(1);return t.set(n,s),s}else return o}function pf(r,t,e){let{prefix:n}=e,o=t.get(n);if(o==null){let s=e.encode(r);return t.set(n,s),s}else return o}var lr=112,mf=18;function Zi(r,t,e){let n=qe(r),o=n+qe(t),s=new Uint8Array(o+e.byteLength);return He(r,s,0),He(t,s,n),s.set(e,o),s}var yf=Symbol.for("@ipld/js-cid/CID");var yo={};St(yo,{identity:()=>Yt});var ji=0,gf="identity",Xi=jt;function wf(r){return kt(ji,Xi(r))}var Yt={code:ji,name:gf,encode:Xi,digest:wf};function wt(r,t){if(r===t)return!0;if(r.byteLength!==t.byteLength)return!1;for(let e=0;e<r.byteLength;e++)if(r[e]!==t[e])return!1;return!0}function Yr(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function xf(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function Ve(r,...t){if(!xf(r))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(r.length))throw new Error("Uint8Array expected of length "+t+", got length="+r.length)}function hr(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Yr(r.outputLen),Yr(r.blockLen)}function Fe(r,t=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(t&&r.finished)throw new Error("Hash#digest() has already been called")}function Yi(r,t){Ve(r);let e=t.outputLen;if(r.length<e)throw new Error("digestInto() expects output buffer of length at least "+e)}var Se=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function Jr(r){return new DataView(r.buffer,r.byteOffset,r.byteLength)}function Kt(r,t){return r<<32-t|r>>>t}function Ji(r){if(typeof r!="string")throw new Error("utf8ToBytes expected string, got "+typeof r);return new Uint8Array(new TextEncoder().encode(r))}function fe(r){return typeof r=="string"&&(r=Ji(r)),Ve(r),r}function go(...r){let t=0;for(let n=0;n<r.length;n++){let o=r[n];Ve(o),t+=o.length}let e=new Uint8Array(t);for(let n=0,o=0;n<r.length;n++){let s=r[n];e.set(s,o),o+=s.length}return e}var ze=class{clone(){return this._cloneInto()}};function Qr(r){let t=n=>r().update(fe(n)).digest(),e=r();return t.outputLen=e.outputLen,t.blockLen=e.blockLen,t.create=()=>r(),t}function dr(r=32){if(Se&&typeof Se.getRandomValues=="function")return Se.getRandomValues(new Uint8Array(r));if(Se&&typeof Se.randomBytes=="function")return Se.randomBytes(r);throw new Error("crypto.getRandomValues must be defined")}function bf(r,t,e,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(t,e,n);let o=BigInt(32),s=BigInt(4294967295),i=Number(e>>o&s),a=Number(e&s),c=n?4:0,f=n?0:4;r.setUint32(t+c,i,n),r.setUint32(t+f,a,n)}function Qi(r,t,e){return r&t^~r&e}function ta(r,t,e){return r&t^r&e^t&e}var Ge=class extends ze{constructor(t,e,n,o){super(),this.blockLen=t,this.outputLen=e,this.padOffset=n,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=Jr(this.buffer)}update(t){Fe(this);let{view:e,buffer:n,blockLen:o}=this;t=fe(t);let s=t.length;for(let i=0;i<s;){let a=Math.min(o-this.pos,s-i);if(a===o){let c=Jr(t);for(;o<=s-i;i+=o)this.process(c,i);continue}n.set(t.subarray(i,i+a),this.pos),this.pos+=a,i+=a,this.pos===o&&(this.process(e,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){Fe(this),Yi(t,this),this.finished=!0;let{buffer:e,view:n,blockLen:o,isLE:s}=this,{pos:i}=this;e[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>o-i&&(this.process(n,0),i=0);for(let l=i;l<o;l++)e[l]=0;bf(n,o-8,BigInt(this.length*8),s),this.process(n,0);let a=Jr(t),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let f=c/4,u=this.get();if(f>u.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<f;l++)a.setUint32(4*l,u[l],s)}digest(){let{buffer:t,outputLen:e}=this;this.digestInto(t);let n=t.slice(0,e);return this.destroy(),n}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());let{blockLen:e,buffer:n,length:o,finished:s,destroyed:i,pos:a}=this;return t.length=o,t.pos=a,t.finished=s,t.destroyed=i,o%e&&t.buffer.set(n),t}};var tn=BigInt(4294967295),wo=BigInt(32);function ea(r,t=!1){return t?{h:Number(r&tn),l:Number(r>>wo&tn)}:{h:Number(r>>wo&tn)|0,l:Number(r&tn)|0}}function Ef(r,t=!1){let e=new Uint32Array(r.length),n=new Uint32Array(r.length);for(let o=0;o<r.length;o++){let{h:s,l:i}=ea(r[o],t);[e[o],n[o]]=[s,i]}return[e,n]}var Sf=(r,t)=>BigInt(r>>>0)<<wo|BigInt(t>>>0),Af=(r,t,e)=>r>>>e,vf=(r,t,e)=>r<<32-e|t>>>e,Bf=(r,t,e)=>r>>>e|t<<32-e,If=(r,t,e)=>r<<32-e|t>>>e,Lf=(r,t,e)=>r<<64-e|t>>>e-32,Tf=(r,t,e)=>r>>>e-32|t<<64-e,_f=(r,t)=>t,Cf=(r,t)=>r,Uf=(r,t,e)=>r<<e|t>>>32-e,Rf=(r,t,e)=>t<<e|r>>>32-e,Pf=(r,t,e)=>t<<e-32|r>>>64-e,kf=(r,t,e)=>r<<e-32|t>>>64-e;function Nf(r,t,e,n){let o=(t>>>0)+(n>>>0);return{h:r+e+(o/2**32|0)|0,l:o|0}}var Df=(r,t,e)=>(r>>>0)+(t>>>0)+(e>>>0),Kf=(r,t,e,n)=>t+e+n+(r/2**32|0)|0,Of=(r,t,e,n)=>(r>>>0)+(t>>>0)+(e>>>0)+(n>>>0),Mf=(r,t,e,n,o)=>t+e+n+o+(r/2**32|0)|0,Hf=(r,t,e,n,o)=>(r>>>0)+(t>>>0)+(e>>>0)+(n>>>0)+(o>>>0),qf=(r,t,e,n,o,s)=>t+e+n+o+s+(r/2**32|0)|0;var Vf={fromBig:ea,split:Ef,toBig:Sf,shrSH:Af,shrSL:vf,rotrSH:Bf,rotrSL:If,rotrBH:Lf,rotrBL:Tf,rotr32H:_f,rotr32L:Cf,rotlSH:Uf,rotlSL:Rf,rotlBH:Pf,rotlBL:kf,add:Nf,add3L:Df,add3H:Kf,add4L:Of,add4H:Mf,add5H:qf,add5L:Hf},V=Vf;var[Ff,zf]=V.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(r=>BigInt(r))),le=new Uint32Array(80),he=new Uint32Array(80),xo=class extends Ge{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){let{Ah:t,Al:e,Bh:n,Bl:o,Ch:s,Cl:i,Dh:a,Dl:c,Eh:f,El:u,Fh:l,Fl:d,Gh:g,Gl:w,Hh:m,Hl:h}=this;return[t,e,n,o,s,i,a,c,f,u,l,d,g,w,m,h]}set(t,e,n,o,s,i,a,c,f,u,l,d,g,w,m,h){this.Ah=t|0,this.Al=e|0,this.Bh=n|0,this.Bl=o|0,this.Ch=s|0,this.Cl=i|0,this.Dh=a|0,this.Dl=c|0,this.Eh=f|0,this.El=u|0,this.Fh=l|0,this.Fl=d|0,this.Gh=g|0,this.Gl=w|0,this.Hh=m|0,this.Hl=h|0}process(t,e){for(let p=0;p<16;p++,e+=4)le[p]=t.getUint32(e),he[p]=t.getUint32(e+=4);for(let p=16;p<80;p++){let I=le[p-15]|0,U=he[p-15]|0,C=V.rotrSH(I,U,1)^V.rotrSH(I,U,8)^V.shrSH(I,U,7),T=V.rotrSL(I,U,1)^V.rotrSL(I,U,8)^V.shrSL(I,U,7),_=le[p-2]|0,B=he[p-2]|0,O=V.rotrSH(_,B,19)^V.rotrBH(_,B,61)^V.shrSH(_,B,6),k=V.rotrSL(_,B,19)^V.rotrBL(_,B,61)^V.shrSL(_,B,6),K=V.add4L(T,k,he[p-7],he[p-16]),H=V.add4H(K,C,O,le[p-7],le[p-16]);le[p]=H|0,he[p]=K|0}let{Ah:n,Al:o,Bh:s,Bl:i,Ch:a,Cl:c,Dh:f,Dl:u,Eh:l,El:d,Fh:g,Fl:w,Gh:m,Gl:h,Hh:x,Hl:E}=this;for(let p=0;p<80;p++){let I=V.rotrSH(l,d,14)^V.rotrSH(l,d,18)^V.rotrBH(l,d,41),U=V.rotrSL(l,d,14)^V.rotrSL(l,d,18)^V.rotrBL(l,d,41),C=l&g^~l&m,T=d&w^~d&h,_=V.add5L(E,U,T,zf[p],he[p]),B=V.add5H(_,x,I,C,Ff[p],le[p]),O=_|0,k=V.rotrSH(n,o,28)^V.rotrBH(n,o,34)^V.rotrBH(n,o,39),K=V.rotrSL(n,o,28)^V.rotrBL(n,o,34)^V.rotrBL(n,o,39),H=n&s^n&a^s&a,v=o&i^o&c^i&c;x=m|0,E=h|0,m=g|0,h=w|0,g=l|0,w=d|0,{h:l,l:d}=V.add(f|0,u|0,B|0,O|0),f=a|0,u=c|0,a=s|0,c=i|0,s=n|0,i=o|0;let L=V.add3L(O,K,v);n=V.add3H(L,B,k,H),o=L|0}({h:n,l:o}=V.add(this.Ah|0,this.Al|0,n|0,o|0)),{h:s,l:i}=V.add(this.Bh|0,this.Bl|0,s|0,i|0),{h:a,l:c}=V.add(this.Ch|0,this.Cl|0,a|0,c|0),{h:f,l:u}=V.add(this.Dh|0,this.Dl|0,f|0,u|0),{h:l,l:d}=V.add(this.Eh|0,this.El|0,l|0,d|0),{h:g,l:w}=V.add(this.Fh|0,this.Fl|0,g|0,w|0),{h:m,l:h}=V.add(this.Gh|0,this.Gl|0,m|0,h|0),{h:x,l:E}=V.add(this.Hh|0,this.Hl|0,x|0,E|0),this.set(n,o,s,i,a,c,f,u,l,d,g,w,m,h,x,E)}roundClean(){le.fill(0),he.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};var ra=Qr(()=>new xo);var nn={};St(nn,{aInRange:()=>xt,abool:()=>Ot,abytes:()=>We,bitGet:()=>Xf,bitLen:()=>Ao,bitMask:()=>mr,bitSet:()=>Yf,bytesToHex:()=>Qt,bytesToNumberBE:()=>te,bytesToNumberLE:()=>Mt,concatBytes:()=>re,createHmacDrbg:()=>vo,ensureBytes:()=>rt,equalBytes:()=>Zf,hexToBytes:()=>ve,hexToNumber:()=>So,inRange:()=>pr,isBytes:()=>de,memoized:()=>Be,notImplemented:()=>Qf,numberToBytesBE:()=>pe,numberToBytesLE:()=>ee,numberToHexUnpadded:()=>Ae,numberToVarBytesBE:()=>$f,utf8ToBytes:()=>jf,validateObject:()=>Nt});var en=BigInt(0),rn=BigInt(1),Gf=BigInt(2);function de(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function We(r){if(!de(r))throw new Error("Uint8Array expected")}function Ot(r,t){if(typeof t!="boolean")throw new Error(r+" boolean expected, got "+t)}var Wf=Array.from({length:256},(r,t)=>t.toString(16).padStart(2,"0"));function Qt(r){We(r);let t="";for(let e=0;e<r.length;e++)t+=Wf[r[e]];return t}function Ae(r){let t=r.toString(16);return t.length&1?"0"+t:t}function So(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);return r===""?en:BigInt("0x"+r)}var Jt={_0:48,_9:57,A:65,F:70,a:97,f:102};function na(r){if(r>=Jt._0&&r<=Jt._9)return r-Jt._0;if(r>=Jt.A&&r<=Jt.F)return r-(Jt.A-10);if(r>=Jt.a&&r<=Jt.f)return r-(Jt.a-10)}function ve(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);let t=r.length,e=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);let n=new Uint8Array(e);for(let o=0,s=0;o<e;o++,s+=2){let i=na(r.charCodeAt(s)),a=na(r.charCodeAt(s+1));if(i===void 0||a===void 0){let c=r[s]+r[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}n[o]=i*16+a}return n}function te(r){return So(Qt(r))}function Mt(r){return We(r),So(Qt(Uint8Array.from(r).reverse()))}function pe(r,t){return ve(r.toString(16).padStart(t*2,"0"))}function ee(r,t){return pe(r,t).reverse()}function $f(r){return ve(Ae(r))}function rt(r,t,e){let n;if(typeof t=="string")try{n=ve(t)}catch(s){throw new Error(r+" must be hex string or Uint8Array, cause: "+s)}else if(de(t))n=Uint8Array.from(t);else throw new Error(r+" must be hex string or Uint8Array");let o=n.length;if(typeof e=="number"&&o!==e)throw new Error(r+" of length "+e+" expected, got "+o);return n}function re(...r){let t=0;for(let n=0;n<r.length;n++){let o=r[n];We(o),t+=o.length}let e=new Uint8Array(t);for(let n=0,o=0;n<r.length;n++){let s=r[n];e.set(s,o),o+=s.length}return e}function Zf(r,t){if(r.length!==t.length)return!1;let e=0;for(let n=0;n<r.length;n++)e|=r[n]^t[n];return e===0}function jf(r){if(typeof r!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(r))}var bo=r=>typeof r=="bigint"&&en<=r;function pr(r,t,e){return bo(r)&&bo(t)&&bo(e)&&t<=r&&r<e}function xt(r,t,e,n){if(!pr(t,e,n))throw new Error("expected valid "+r+": "+e+" <= n < "+n+", got "+t)}function Ao(r){let t;for(t=0;r>en;r>>=rn,t+=1);return t}function Xf(r,t){return r>>BigInt(t)&rn}function Yf(r,t,e){return r|(e?rn:en)<<BigInt(t)}var mr=r=>(Gf<<BigInt(r-1))-rn,Eo=r=>new Uint8Array(r),oa=r=>Uint8Array.from(r);function vo(r,t,e){if(typeof r!="number"||r<2)throw new Error("hashLen must be a number");if(typeof t!="number"||t<2)throw new Error("qByteLen must be a number");if(typeof e!="function")throw new Error("hmacFn must be a function");let n=Eo(r),o=Eo(r),s=0,i=()=>{n.fill(1),o.fill(0),s=0},a=(...l)=>e(o,n,...l),c=(l=Eo())=>{o=a(oa([0]),l),n=a(),l.length!==0&&(o=a(oa([1]),l),n=a())},f=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let l=0,d=[];for(;l<t;){n=a();let g=n.slice();d.push(g),l+=n.length}return re(...d)};return(l,d)=>{i(),c(l);let g;for(;!(g=d(f()));)c();return i(),g}}var Jf={bigint:r=>typeof r=="bigint",function:r=>typeof r=="function",boolean:r=>typeof r=="boolean",string:r=>typeof r=="string",stringOrUint8Array:r=>typeof r=="string"||de(r),isSafeInteger:r=>Number.isSafeInteger(r),array:r=>Array.isArray(r),field:(r,t)=>t.Fp.isValid(r),hash:r=>typeof r=="function"&&Number.isSafeInteger(r.outputLen)};function Nt(r,t,e={}){let n=(o,s,i)=>{let a=Jf[s];if(typeof a!="function")throw new Error("invalid validator function");let c=r[o];if(!(i&&c===void 0)&&!a(c,r))throw new Error("param "+String(o)+" is invalid. Expected "+s+", got "+c)};for(let[o,s]of Object.entries(t))n(o,s,!1);for(let[o,s]of Object.entries(e))n(o,s,!0);return r}var Qf=()=>{throw new Error("not implemented")};function Be(r){let t=new WeakMap;return(e,...n)=>{let o=t.get(e);if(o!==void 0)return o;let s=r(e,...n);return t.set(e,s),s}}var ht=BigInt(0),at=BigInt(1),Ie=BigInt(2),tl=BigInt(3),Bo=BigInt(4),sa=BigInt(5),ia=BigInt(8),el=BigInt(9),rl=BigInt(16);function j(r,t){let e=r%t;return e>=ht?e:t+e}function Io(r,t,e){if(t<ht)throw new Error("invalid exponent, negatives unsupported");if(e<=ht)throw new Error("invalid modulus");if(e===at)return ht;let n=at;for(;t>ht;)t&at&&(n=n*r%e),r=r*r%e,t>>=at;return n}function st(r,t,e){let n=r;for(;t-- >ht;)n*=n,n%=e;return n}function on(r,t){if(r===ht)throw new Error("invert: expected non-zero number");if(t<=ht)throw new Error("invert: expected positive modulus, got "+t);let e=j(r,t),n=t,o=ht,s=at,i=at,a=ht;for(;e!==ht;){let f=n/e,u=n%e,l=o-i*f,d=s-a*f;n=e,e=u,o=i,s=a,i=l,a=d}if(n!==at)throw new Error("invert: does not exist");return j(o,t)}function nl(r){let t=(r-at)/Ie,e,n,o;for(e=r-at,n=0;e%Ie===ht;e/=Ie,n++);for(o=Ie;o<r&&Io(o,t,r)!==r-at;o++)if(o>1e3)throw new Error("Cannot find square root: likely non-prime P");if(n===1){let i=(r+at)/Bo;return function(c,f){let u=c.pow(f,i);if(!c.eql(c.sqr(u),f))throw new Error("Cannot find square root");return u}}let s=(e+at)/Ie;return function(a,c){if(a.pow(c,t)===a.neg(a.ONE))throw new Error("Cannot find square root");let f=n,u=a.pow(a.mul(a.ONE,o),e),l=a.pow(c,s),d=a.pow(c,e);for(;!a.eql(d,a.ONE);){if(a.eql(d,a.ZERO))return a.ZERO;let g=1;for(let m=a.sqr(d);g<f&&!a.eql(m,a.ONE);g++)m=a.sqr(m);let w=a.pow(u,at<<BigInt(f-g-1));u=a.sqr(w),l=a.mul(l,w),d=a.mul(d,u),f=g}return l}}function ol(r){if(r%Bo===tl){let t=(r+at)/Bo;return function(n,o){let s=n.pow(o,t);if(!n.eql(n.sqr(s),o))throw new Error("Cannot find square root");return s}}if(r%ia===sa){let t=(r-sa)/ia;return function(n,o){let s=n.mul(o,Ie),i=n.pow(s,t),a=n.mul(o,i),c=n.mul(n.mul(a,Ie),i),f=n.mul(a,n.sub(c,n.ONE));if(!n.eql(n.sqr(f),o))throw new Error("Cannot find square root");return f}}return r%rl,nl(r)}var aa=(r,t)=>(j(r,t)&at)===at,sl=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Lo(r){let t={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},e=sl.reduce((n,o)=>(n[o]="function",n),t);return Nt(r,e)}function il(r,t,e){if(e<ht)throw new Error("invalid exponent, negatives unsupported");if(e===ht)return r.ONE;if(e===at)return t;let n=r.ONE,o=t;for(;e>ht;)e&at&&(n=r.mul(n,o)),o=r.sqr(o),e>>=at;return n}function al(r,t){let e=new Array(t.length),n=t.reduce((s,i,a)=>r.is0(i)?s:(e[a]=s,r.mul(s,i)),r.ONE),o=r.inv(n);return t.reduceRight((s,i,a)=>r.is0(i)?s:(e[a]=r.mul(s,e[a]),r.mul(s,i)),o),e}function To(r,t){let e=t!==void 0?t:r.toString(2).length,n=Math.ceil(e/8);return{nBitLength:e,nByteLength:n}}function me(r,t,e=!1,n={}){if(r<=ht)throw new Error("invalid field: expected ORDER > 0, got "+r);let{nBitLength:o,nByteLength:s}=To(r,t);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let i,a=Object.freeze({ORDER:r,isLE:e,BITS:o,BYTES:s,MASK:mr(o),ZERO:ht,ONE:at,create:c=>j(c,r),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return ht<=c&&c<r},is0:c=>c===ht,isOdd:c=>(c&at)===at,neg:c=>j(-c,r),eql:(c,f)=>c===f,sqr:c=>j(c*c,r),add:(c,f)=>j(c+f,r),sub:(c,f)=>j(c-f,r),mul:(c,f)=>j(c*f,r),pow:(c,f)=>il(a,c,f),div:(c,f)=>j(c*on(f,r),r),sqrN:c=>c*c,addN:(c,f)=>c+f,subN:(c,f)=>c-f,mulN:(c,f)=>c*f,inv:c=>on(c,r),sqrt:n.sqrt||(c=>(i||(i=ol(r)),i(a,c))),invertBatch:c=>al(a,c),cmov:(c,f,u)=>u?f:c,toBytes:c=>e?ee(c,s):pe(c,s),fromBytes:c=>{if(c.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+c.length);return e?Mt(c):te(c)}});return Object.freeze(a)}function ca(r){if(typeof r!="bigint")throw new Error("field order must be bigint");let t=r.toString(2).length;return Math.ceil(t/8)}function _o(r){let t=ca(r);return t+Math.ceil(t/2)}function ua(r,t,e=!1){let n=r.length,o=ca(t),s=_o(t);if(n<16||n<s||n>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+n);let i=e?Mt(r):te(r),a=j(i,t-at)+at;return e?ee(a,o):pe(a,o)}var fa=BigInt(0),sn=BigInt(1);function Co(r,t){let e=t.negate();return r?e:t}function la(r,t){if(!Number.isSafeInteger(r)||r<=0||r>t)throw new Error("invalid window size, expected [1.."+t+"], got W="+r)}function Uo(r,t){la(r,t);let e=Math.ceil(t/r)+1,n=2**(r-1);return{windows:e,windowSize:n}}function cl(r,t){if(!Array.isArray(r))throw new Error("array expected");r.forEach((e,n)=>{if(!(e instanceof t))throw new Error("invalid point at index "+n)})}function ul(r,t){if(!Array.isArray(r))throw new Error("array of scalars expected");r.forEach((e,n)=>{if(!t.isValid(e))throw new Error("invalid scalar at index "+n)})}var Ro=new WeakMap,ha=new WeakMap;function Po(r){return ha.get(r)||1}function an(r,t){return{constTimeNegate:Co,hasPrecomputes(e){return Po(e)!==1},unsafeLadder(e,n,o=r.ZERO){let s=e;for(;n>fa;)n&sn&&(o=o.add(s)),s=s.double(),n>>=sn;return o},precomputeWindow(e,n){let{windows:o,windowSize:s}=Uo(n,t),i=[],a=e,c=a;for(let f=0;f<o;f++){c=a,i.push(c);for(let u=1;u<s;u++)c=c.add(a),i.push(c);a=c.double()}return i},wNAF(e,n,o){let{windows:s,windowSize:i}=Uo(e,t),a=r.ZERO,c=r.BASE,f=BigInt(2**e-1),u=2**e,l=BigInt(e);for(let d=0;d<s;d++){let g=d*i,w=Number(o&f);o>>=l,w>i&&(w-=u,o+=sn);let m=g,h=g+Math.abs(w)-1,x=d%2!==0,E=w<0;w===0?c=c.add(Co(x,n[m])):a=a.add(Co(E,n[h]))}return{p:a,f:c}},wNAFUnsafe(e,n,o,s=r.ZERO){let{windows:i,windowSize:a}=Uo(e,t),c=BigInt(2**e-1),f=2**e,u=BigInt(e);for(let l=0;l<i;l++){let d=l*a;if(o===fa)break;let g=Number(o&c);if(o>>=u,g>a&&(g-=f,o+=sn),g===0)continue;let w=n[d+Math.abs(g)-1];g<0&&(w=w.negate()),s=s.add(w)}return s},getPrecomputes(e,n,o){let s=Ro.get(n);return s||(s=this.precomputeWindow(n,e),e!==1&&Ro.set(n,o(s))),s},wNAFCached(e,n,o){let s=Po(e);return this.wNAF(s,this.getPrecomputes(s,e,o),n)},wNAFCachedUnsafe(e,n,o,s){let i=Po(e);return i===1?this.unsafeLadder(e,n,s):this.wNAFUnsafe(i,this.getPrecomputes(i,e,o),n,s)},setWindowSize(e,n){la(n,t),ha.set(e,n),Ro.delete(e)}}}function cn(r,t,e,n){if(cl(e,r),ul(n,t),e.length!==n.length)throw new Error("arrays of points and scalars must have equal length");let o=r.ZERO,s=Ao(BigInt(e.length)),i=s>12?s-3:s>4?s-2:s?2:1,a=(1<<i)-1,c=new Array(a+1).fill(o),f=Math.floor((t.BITS-1)/i)*i,u=o;for(let l=f;l>=0;l-=i){c.fill(o);for(let g=0;g<n.length;g++){let w=n[g],m=Number(w>>BigInt(l)&BigInt(a));c[m]=c[m].add(e[g])}let d=o;for(let g=c.length-1,w=o;g>0;g--)w=w.add(c[g]),d=d.add(w);if(u=u.add(d),l!==0)for(let g=0;g<i;g++)u=u.double()}return u}function yr(r){return Lo(r.Fp),Nt(r,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...To(r.n,r.nBitLength),...r,p:r.Fp.ORDER})}var Ht=BigInt(0),Rt=BigInt(1),un=BigInt(2),fl=BigInt(8),ll={zip215:!0};function hl(r){let t=yr(r);return Nt(r,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...t})}function da(r){let t=hl(r),{Fp:e,n,prehash:o,hash:s,randomBytes:i,nByteLength:a,h:c}=t,f=un<<BigInt(a*8)-Rt,u=e.create,l=me(t.n,t.nBitLength),d=t.uvRatio||((b,y)=>{try{return{isValid:!0,value:e.sqrt(b*e.inv(y))}}catch{return{isValid:!1,value:Ht}}}),g=t.adjustScalarBytes||(b=>b),w=t.domain||((b,y,A)=>{if(Ot("phflag",A),y.length||A)throw new Error("Contexts/pre-hash are not supported");return b});function m(b,y){xt("coordinate "+b,y,Ht,f)}function h(b){if(!(b instanceof p))throw new Error("ExtendedPoint expected")}let x=Be((b,y)=>{let{ex:A,ey:S,ez:R}=b,P=b.is0();y==null&&(y=P?fl:e.inv(R));let D=u(A*y),q=u(S*y),M=u(R*y);if(P)return{x:Ht,y:Rt};if(M!==Rt)throw new Error("invZ was invalid");return{x:D,y:q}}),E=Be(b=>{let{a:y,d:A}=t;if(b.is0())throw new Error("bad point: ZERO");let{ex:S,ey:R,ez:P,et:D}=b,q=u(S*S),M=u(R*R),z=u(P*P),$=u(z*z),nt=u(q*y),ot=u(z*u(nt+M)),it=u($+u(A*u(q*M)));if(ot!==it)throw new Error("bad point: equation left != right (1)");let Et=u(S*R),Ut=u(P*D);if(Et!==Ut)throw new Error("bad point: equation left != right (2)");return!0});class p{constructor(y,A,S,R){this.ex=y,this.ey=A,this.ez=S,this.et=R,m("x",y),m("y",A),m("z",S),m("t",R),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(y){if(y instanceof p)throw new Error("extended point not allowed");let{x:A,y:S}=y||{};return m("x",A),m("y",S),new p(A,S,Rt,u(A*S))}static normalizeZ(y){let A=e.invertBatch(y.map(S=>S.ez));return y.map((S,R)=>S.toAffine(A[R])).map(p.fromAffine)}static msm(y,A){return cn(p,l,y,A)}_setWindowSize(y){C.setWindowSize(this,y)}assertValidity(){E(this)}equals(y){h(y);let{ex:A,ey:S,ez:R}=this,{ex:P,ey:D,ez:q}=y,M=u(A*q),z=u(P*R),$=u(S*q),nt=u(D*R);return M===z&&$===nt}is0(){return this.equals(p.ZERO)}negate(){return new p(u(-this.ex),this.ey,this.ez,u(-this.et))}double(){let{a:y}=t,{ex:A,ey:S,ez:R}=this,P=u(A*A),D=u(S*S),q=u(un*u(R*R)),M=u(y*P),z=A+S,$=u(u(z*z)-P-D),nt=M+D,ot=nt-q,it=M-D,Et=u($*ot),Ut=u(nt*it),_t=u($*it),Ft=u(ot*nt);return new p(Et,Ut,Ft,_t)}add(y){h(y);let{a:A,d:S}=t,{ex:R,ey:P,ez:D,et:q}=this,{ex:M,ey:z,ez:$,et:nt}=y;if(A===BigInt(-1)){let Ti=u((P-R)*(z+M)),_i=u((P+R)*(z-M)),ro=u(_i-Ti);if(ro===Ht)return this.double();let Ci=u(D*un*nt),Ui=u(q*un*$),Ri=Ui+Ci,Pi=_i+Ti,ki=Ui-Ci,Su=u(Ri*ro),Au=u(Pi*ki),vu=u(Ri*ki),Bu=u(ro*Pi);return new p(Su,Au,Bu,vu)}let ot=u(R*M),it=u(P*z),Et=u(q*S*nt),Ut=u(D*$),_t=u((R+P)*(M+z)-ot-it),Ft=Ut-Et,Zt=Ut+Et,ar=u(it-A*ot),wu=u(_t*Ft),xu=u(Zt*ar),bu=u(_t*ar),Eu=u(Ft*Zt);return new p(wu,xu,Eu,bu)}subtract(y){return this.add(y.negate())}wNAF(y){return C.wNAFCached(this,y,p.normalizeZ)}multiply(y){let A=y;xt("scalar",A,Rt,n);let{p:S,f:R}=this.wNAF(A);return p.normalizeZ([S,R])[0]}multiplyUnsafe(y,A=p.ZERO){let S=y;return xt("scalar",S,Ht,n),S===Ht?U:this.is0()||S===Rt?this:C.wNAFCachedUnsafe(this,S,p.normalizeZ,A)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return C.unsafeLadder(this,n).is0()}toAffine(y){return x(this,y)}clearCofactor(){let{h:y}=t;return y===Rt?this:this.multiplyUnsafe(y)}static fromHex(y,A=!1){let{d:S,a:R}=t,P=e.BYTES;y=rt("pointHex",y,P),Ot("zip215",A);let D=y.slice(),q=y[P-1];D[P-1]=q&-129;let M=Mt(D),z=A?f:e.ORDER;xt("pointHex.y",M,Ht,z);let $=u(M*M),nt=u($-Rt),ot=u(S*$-R),{isValid:it,value:Et}=d(nt,ot);if(!it)throw new Error("Point.fromHex: invalid y coordinate");let Ut=(Et&Rt)===Rt,_t=(q&128)!==0;if(!A&&Et===Ht&&_t)throw new Error("Point.fromHex: x=0 and x_0=1");return _t!==Ut&&(Et=u(-Et)),p.fromAffine({x:Et,y:M})}static fromPrivateKey(y){return B(y).point}toRawBytes(){let{x:y,y:A}=this.toAffine(),S=ee(A,e.BYTES);return S[S.length-1]|=y&Rt?128:0,S}toHex(){return Qt(this.toRawBytes())}}p.BASE=new p(t.Gx,t.Gy,Rt,u(t.Gx*t.Gy)),p.ZERO=new p(Ht,Rt,Rt,Ht);let{BASE:I,ZERO:U}=p,C=an(p,a*8);function T(b){return j(b,n)}function _(b){return T(Mt(b))}function B(b){let y=e.BYTES;b=rt("private key",b,y);let A=rt("hashed private key",s(b),2*y),S=g(A.slice(0,y)),R=A.slice(y,2*y),P=_(S),D=I.multiply(P),q=D.toRawBytes();return{head:S,prefix:R,scalar:P,point:D,pointBytes:q}}function O(b){return B(b).pointBytes}function k(b=new Uint8Array,...y){let A=re(...y);return _(s(w(A,rt("context",b),!!o)))}function K(b,y,A={}){b=rt("message",b),o&&(b=o(b));let{prefix:S,scalar:R,pointBytes:P}=B(y),D=k(A.context,S,b),q=I.multiply(D).toRawBytes(),M=k(A.context,q,P,b),z=T(D+M*R);xt("signature.s",z,Ht,n);let $=re(q,ee(z,e.BYTES));return rt("result",$,e.BYTES*2)}let H=ll;function v(b,y,A,S=H){let{context:R,zip215:P}=S,D=e.BYTES;b=rt("signature",b,2*D),y=rt("message",y),A=rt("publicKey",A,D),P!==void 0&&Ot("zip215",P),o&&(y=o(y));let q=Mt(b.slice(D,2*D)),M,z,$;try{M=p.fromHex(A,P),z=p.fromHex(b.slice(0,D),P),$=I.multiplyUnsafe(q)}catch{return!1}if(!P&&M.isSmallOrder())return!1;let nt=k(R,z.toRawBytes(),M.toRawBytes(),y);return z.add(M.multiplyUnsafe(nt)).subtract($).clearCofactor().equals(p.ZERO)}return I._setWindowSize(8),{CURVE:t,getPublicKey:O,sign:K,verify:v,ExtendedPoint:p,utils:{getExtendedPublicKey:B,randomPrivateKey:()=>i(e.BYTES),precompute(b=8,y=p.BASE){return y._setWindowSize(b),y.multiply(BigInt(3)),y}}}}var $e=BigInt(0),ko=BigInt(1);function dl(r){return Nt(r,{a:"bigint"},{montgomeryBits:"isSafeInteger",nByteLength:"isSafeInteger",adjustScalarBytes:"function",domain:"function",powPminus2:"function",Gu:"bigint"}),Object.freeze({...r})}function pa(r){let t=dl(r),{P:e}=t,n=E=>j(E,e),o=t.montgomeryBits,s=Math.ceil(o/8),i=t.nByteLength,a=t.adjustScalarBytes||(E=>E),c=t.powPminus2||(E=>Io(E,e-BigInt(2),e));function f(E,p,I){let U=n(E*(p-I));return p=n(p-U),I=n(I+U),[p,I]}let u=(t.a-BigInt(2))/BigInt(4);function l(E,p){xt("u",E,$e,e),xt("scalar",p,$e,e);let I=p,U=E,C=ko,T=$e,_=E,B=ko,O=$e,k;for(let H=BigInt(o-1);H>=$e;H--){let v=I>>H&ko;O^=v,k=f(O,C,_),C=k[0],_=k[1],k=f(O,T,B),T=k[0],B=k[1],O=v;let L=C+T,b=n(L*L),y=C-T,A=n(y*y),S=b-A,R=_+B,P=_-B,D=n(P*L),q=n(R*y),M=D+q,z=D-q;_=n(M*M),B=n(U*n(z*z)),C=n(b*A),T=n(S*(b+n(u*S)))}k=f(O,C,_),C=k[0],_=k[1],k=f(O,T,B),T=k[0],B=k[1];let K=c(T);return n(C*K)}function d(E){return ee(n(E),s)}function g(E){let p=rt("u coordinate",E,s);return i===32&&(p[31]&=127),Mt(p)}function w(E){let p=rt("scalar",E),I=p.length;if(I!==s&&I!==i){let U=""+s+" or "+i;throw new Error("invalid scalar, expected "+U+" bytes, got "+I)}return Mt(a(p))}function m(E,p){let I=g(p),U=w(E),C=l(I,U);if(C===$e)throw new Error("invalid private or public key received");return d(C)}let h=d(t.Gu);function x(E){return m(E,h)}return{scalarMult:m,scalarMultBase:x,getSharedSecret:(E,p)=>m(E,p),getPublicKey:E=>x(E),utils:{randomPrivateKey:()=>t.randomBytes(t.nByteLength)},GuBytes:h}}var gr=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),ma=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752"),r0=BigInt(0),pl=BigInt(1),ya=BigInt(2),ml=BigInt(3),yl=BigInt(5),gl=BigInt(8);function ga(r){let t=BigInt(10),e=BigInt(20),n=BigInt(40),o=BigInt(80),s=gr,a=r*r%s*r%s,c=st(a,ya,s)*a%s,f=st(c,pl,s)*r%s,u=st(f,yl,s)*f%s,l=st(u,t,s)*u%s,d=st(l,e,s)*l%s,g=st(d,n,s)*d%s,w=st(g,o,s)*g%s,m=st(w,o,s)*g%s,h=st(m,t,s)*u%s;return{pow_p_5_8:st(h,ya,s)*r%s,b2:a}}function wa(r){return r[0]&=248,r[31]&=127,r[31]|=64,r}function wl(r,t){let e=gr,n=j(t*t*t,e),o=j(n*n*t,e),s=ga(r*o).pow_p_5_8,i=j(r*n*s,e),a=j(t*i*i,e),c=i,f=j(i*ma,e),u=a===r,l=a===j(-r,e),d=a===j(-r*ma,e);return u&&(i=c),(l||d)&&(i=f),aa(i,e)&&(i=j(-i,e)),{isValid:u||l,value:i}}var xl=me(gr,void 0,!0),bl={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:xl,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:gl,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:ra,randomBytes:dr,adjustScalarBytes:wa,uvRatio:wl},xa=da(bl);var wr=pa({P:gr,a:BigInt(486662),montgomeryBits:255,nByteLength:32,Gu:BigInt(9),powPminus2:r=>{let t=gr,{pow_p_5_8:e,b2:n}=ga(r);return j(st(e,ml,t)*n,t)},adjustScalarBytes:wa,randomBytes:dr});var fn=32;function ba(r,t,e){return xa.verify(t,e instanceof Uint8Array?e:e.subarray(),r)}var ln=class{type="Ed25519";raw;constructor(t){this.raw=No(t,fn)}toMultihash(){return Yt.digest(Ze(this))}toCID(){return lt.createV1(114,this.toMultihash())}toString(){return et.encode(this.toMultihash().bytes).substring(1)}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:wt(this.raw,t.raw)}verify(t,e){return ba(this.raw,e,t)}};function Do(r){return r=No(r,fn),new ln(r)}function No(r,t){if(r=Uint8Array.from(r??[]),r.length!==t)throw new yt(`Key must be a Uint8Array of length ${t}, got ${r.length}`);return r}function dt(r=0){return new Uint8Array(r)}function pt(r=0){return new Uint8Array(r)}var Sl=Math.pow(2,7),Al=Math.pow(2,14),vl=Math.pow(2,21),Ko=Math.pow(2,28),Oo=Math.pow(2,35),Mo=Math.pow(2,42),Ho=Math.pow(2,49),Y=128,At=127;function ft(r){if(r<Sl)return 1;if(r<Al)return 2;if(r<vl)return 3;if(r<Ko)return 4;if(r<Oo)return 5;if(r<Mo)return 6;if(r<Ho)return 7;if(Number.MAX_SAFE_INTEGER!=null&&r>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return 8}function qo(r,t,e=0){switch(ft(r)){case 8:t[e++]=r&255|Y,r/=128;case 7:t[e++]=r&255|Y,r/=128;case 6:t[e++]=r&255|Y,r/=128;case 5:t[e++]=r&255|Y,r/=128;case 4:t[e++]=r&255|Y,r>>>=7;case 3:t[e++]=r&255|Y,r>>>=7;case 2:t[e++]=r&255|Y,r>>>=7;case 1:{t[e++]=r&255,r>>>=7;break}default:throw new Error("unreachable")}return t}function Bl(r,t,e=0){switch(ft(r)){case 8:t.set(e++,r&255|Y),r/=128;case 7:t.set(e++,r&255|Y),r/=128;case 6:t.set(e++,r&255|Y),r/=128;case 5:t.set(e++,r&255|Y),r/=128;case 4:t.set(e++,r&255|Y),r>>>=7;case 3:t.set(e++,r&255|Y),r>>>=7;case 2:t.set(e++,r&255|Y),r>>>=7;case 1:{t.set(e++,r&255),r>>>=7;break}default:throw new Error("unreachable")}return t}function Vo(r,t){let e=r[t],n=0;if(n+=e&At,e<Y||(e=r[t+1],n+=(e&At)<<7,e<Y)||(e=r[t+2],n+=(e&At)<<14,e<Y)||(e=r[t+3],n+=(e&At)<<21,e<Y)||(e=r[t+4],n+=(e&At)*Ko,e<Y)||(e=r[t+5],n+=(e&At)*Oo,e<Y)||(e=r[t+6],n+=(e&At)*Mo,e<Y)||(e=r[t+7],n+=(e&At)*Ho,e<Y))return n;throw new RangeError("Could not decode varint")}function Il(r,t){let e=r.get(t),n=0;if(n+=e&At,e<Y||(e=r.get(t+1),n+=(e&At)<<7,e<Y)||(e=r.get(t+2),n+=(e&At)<<14,e<Y)||(e=r.get(t+3),n+=(e&At)<<21,e<Y)||(e=r.get(t+4),n+=(e&At)*Ko,e<Y)||(e=r.get(t+5),n+=(e&At)*Oo,e<Y)||(e=r.get(t+6),n+=(e&At)*Mo,e<Y)||(e=r.get(t+7),n+=(e&At)*Ho,e<Y))return n;throw new RangeError("Could not decode varint")}function Gt(r,t,e=0){return t==null&&(t=pt(ft(r))),t instanceof Uint8Array?qo(r,t,e):Bl(r,t,e)}function qt(r,t=0){return r instanceof Uint8Array?Vo(r,t):Il(r,t)}var Fo=new Float32Array([-0]),ye=new Uint8Array(Fo.buffer);function Sa(r,t,e){Fo[0]=r,t[e]=ye[0],t[e+1]=ye[1],t[e+2]=ye[2],t[e+3]=ye[3]}function Aa(r,t){return ye[0]=r[t],ye[1]=r[t+1],ye[2]=r[t+2],ye[3]=r[t+3],Fo[0]}var zo=new Float64Array([-0]),vt=new Uint8Array(zo.buffer);function va(r,t,e){zo[0]=r,t[e]=vt[0],t[e+1]=vt[1],t[e+2]=vt[2],t[e+3]=vt[3],t[e+4]=vt[4],t[e+5]=vt[5],t[e+6]=vt[6],t[e+7]=vt[7]}function Ba(r,t){return vt[0]=r[t],vt[1]=r[t+1],vt[2]=r[t+2],vt[3]=r[t+3],vt[4]=r[t+4],vt[5]=r[t+5],vt[6]=r[t+6],vt[7]=r[t+7],zo[0]}var Ll=BigInt(Number.MAX_SAFE_INTEGER),Tl=BigInt(Number.MIN_SAFE_INTEGER),Pt=class r{lo;hi;constructor(t,e){this.lo=t|0,this.hi=e|0}toNumber(t=!1){if(!t&&this.hi>>>31>0){let e=~this.lo+1>>>0,n=~this.hi>>>0;return e===0&&(n=n+1>>>0),-(e+n*4294967296)}return this.lo+this.hi*4294967296}toBigInt(t=!1){if(t)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31){let e=~this.lo+1>>>0,n=~this.hi>>>0;return e===0&&(n=n+1>>>0),-(BigInt(e)+(BigInt(n)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toString(t=!1){return this.toBigInt(t).toString()}zzEncode(){let t=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^t)>>>0,this.lo=(this.lo<<1^t)>>>0,this}zzDecode(){let t=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^t)>>>0,this.hi=(this.hi>>>1^t)>>>0,this}length(){let t=this.lo,e=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return n===0?e===0?t<16384?t<128?1:2:t<2097152?3:4:e<16384?e<128?5:6:e<2097152?7:8:n<128?9:10}static fromBigInt(t){if(t===0n)return Le;if(t<Ll&&t>Tl)return this.fromNumber(Number(t));let e=t<0n;e&&(t=-t);let n=t>>32n,o=t-(n<<32n);return e&&(n=~n|0n,o=~o|0n,++o>Ia&&(o=0n,++n>Ia&&(n=0n))),new r(Number(o),Number(n))}static fromNumber(t){if(t===0)return Le;let e=t<0;e&&(t=-t);let n=t>>>0,o=(t-n)/4294967296>>>0;return e&&(o=~o>>>0,n=~n>>>0,++n>4294967295&&(n=0,++o>4294967295&&(o=0))),new r(n,o)}static from(t){return typeof t=="number"?r.fromNumber(t):typeof t=="bigint"?r.fromBigInt(t):typeof t=="string"?r.fromBigInt(BigInt(t)):t.low!=null||t.high!=null?new r(t.low>>>0,t.high>>>0):Le}},Le=new Pt(0,0);Le.toBigInt=function(){return 0n};Le.zzEncode=Le.zzDecode=function(){return this};Le.length=function(){return 1};var Ia=4294967296n;function La(r){let t=0,e=0;for(let n=0;n<r.length;++n)e=r.charCodeAt(n),e<128?t+=1:e<2048?t+=2:(e&64512)===55296&&(r.charCodeAt(n+1)&64512)===56320?(++n,t+=4):t+=3;return t}function Ta(r,t,e){if(e-t<1)return"";let o,s=[],i=0,a;for(;t<e;)a=r[t++],a<128?s[i++]=a:a>191&&a<224?s[i++]=(a&31)<<6|r[t++]&63:a>239&&a<365?(a=((a&7)<<18|(r[t++]&63)<<12|(r[t++]&63)<<6|r[t++]&63)-65536,s[i++]=55296+(a>>10),s[i++]=56320+(a&1023)):s[i++]=(a&15)<<12|(r[t++]&63)<<6|r[t++]&63,i>8191&&((o??(o=[])).push(String.fromCharCode.apply(String,s)),i=0);return o!=null?(i>0&&o.push(String.fromCharCode.apply(String,s.slice(0,i))),o.join("")):String.fromCharCode.apply(String,s.slice(0,i))}function Go(r,t,e){let n=e,o,s;for(let i=0;i<r.length;++i)o=r.charCodeAt(i),o<128?t[e++]=o:o<2048?(t[e++]=o>>6|192,t[e++]=o&63|128):(o&64512)===55296&&((s=r.charCodeAt(i+1))&64512)===56320?(o=65536+((o&1023)<<10)+(s&1023),++i,t[e++]=o>>18|240,t[e++]=o>>12&63|128,t[e++]=o>>6&63|128,t[e++]=o&63|128):(t[e++]=o>>12|224,t[e++]=o>>6&63|128,t[e++]=o&63|128);return e-n}function Vt(r,t){return RangeError(`index out of range: ${r.pos} + ${t??1} > ${r.len}`)}function hn(r,t){return(r[t-4]|r[t-3]<<8|r[t-2]<<16|r[t-1]<<24)>>>0}var Wo=class{buf;pos;len;_slice=Uint8Array.prototype.subarray;constructor(t){this.buf=t,this.pos=0,this.len=t.length}uint32(){let t=4294967295;if(t=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(t=(t|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return t;if((this.pos+=5)>this.len)throw this.pos=this.len,Vt(this,10);return t}int32(){return this.uint32()|0}sint32(){let t=this.uint32();return t>>>1^-(t&1)|0}bool(){return this.uint32()!==0}fixed32(){if(this.pos+4>this.len)throw Vt(this,4);return hn(this.buf,this.pos+=4)}sfixed32(){if(this.pos+4>this.len)throw Vt(this,4);return hn(this.buf,this.pos+=4)|0}float(){if(this.pos+4>this.len)throw Vt(this,4);let t=Aa(this.buf,this.pos);return this.pos+=4,t}double(){if(this.pos+8>this.len)throw Vt(this,4);let t=Ba(this.buf,this.pos);return this.pos+=8,t}bytes(){let t=this.uint32(),e=this.pos,n=this.pos+t;if(n>this.len)throw Vt(this,t);return this.pos+=t,e===n?new Uint8Array(0):this.buf.subarray(e,n)}string(){let t=this.bytes();return Ta(t,0,t.length)}skip(t){if(typeof t=="number"){if(this.pos+t>this.len)throw Vt(this,t);this.pos+=t}else do if(this.pos>=this.len)throw Vt(this);while((this.buf[this.pos++]&128)!==0);return this}skipType(t){switch(t){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(t=this.uint32()&7)!==4;)this.skipType(t);break;case 5:this.skip(4);break;default:throw Error(`invalid wire type ${t} at offset ${this.pos}`)}return this}readLongVarint(){let t=new Pt(0,0),e=0;if(this.len-this.pos>4){for(;e<4;++e)if(t.lo=(t.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return t;if(t.lo=(t.lo|(this.buf[this.pos]&127)<<28)>>>0,t.hi=(t.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return t;e=0}else{for(;e<3;++e){if(this.pos>=this.len)throw Vt(this);if(t.lo=(t.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return t}return t.lo=(t.lo|(this.buf[this.pos++]&127)<<e*7)>>>0,t}if(this.len-this.pos>4){for(;e<5;++e)if(t.hi=(t.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return t}else for(;e<5;++e){if(this.pos>=this.len)throw Vt(this);if(t.hi=(t.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return t}throw Error("invalid varint encoding")}readFixed64(){if(this.pos+8>this.len)throw Vt(this,8);let t=hn(this.buf,this.pos+=4),e=hn(this.buf,this.pos+=4);return new Pt(t,e)}int64(){return this.readLongVarint().toBigInt()}int64Number(){return this.readLongVarint().toNumber()}int64String(){return this.readLongVarint().toString()}uint64(){return this.readLongVarint().toBigInt(!0)}uint64Number(){let t=Vo(this.buf,this.pos);return this.pos+=ft(t),t}uint64String(){return this.readLongVarint().toString(!0)}sint64(){return this.readLongVarint().zzDecode().toBigInt()}sint64Number(){return this.readLongVarint().zzDecode().toNumber()}sint64String(){return this.readLongVarint().zzDecode().toString()}fixed64(){return this.readFixed64().toBigInt()}fixed64Number(){return this.readFixed64().toNumber()}fixed64String(){return this.readFixed64().toString()}sfixed64(){return this.readFixed64().toBigInt()}sfixed64Number(){return this.readFixed64().toNumber()}sfixed64String(){return this.readFixed64().toString()}};function $o(r){return new Wo(r instanceof Uint8Array?r:r.subarray())}function Te(r,t,e){let n=$o(r);return t.decode(n,void 0,e)}var Zo={};St(Zo,{base10:()=>_l});var _l=ce({prefix:"9",name:"base10",alphabet:"0123456789"});var jo={};St(jo,{base16:()=>Cl,base16upper:()=>Ul});var Cl=ut({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Ul=ut({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Xo={};St(Xo,{base2:()=>Rl});var Rl=ut({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Yo={};St(Yo,{base256emoji:()=>Kl});var Ca=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),Pl=Ca.reduce((r,t,e)=>(r[e]=t,r),[]),kl=Ca.reduce((r,t,e)=>{let n=t.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${t}`);return r[n]=e,r},[]);function Nl(r){return r.reduce((t,e)=>(t+=Pl[e],t),"")}function Dl(r){let t=[];for(let e of r){let n=e.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${e}`);let o=kl[n];if(o==null)throw new Error(`Non-base256emoji character: ${e}`);t.push(o)}return new Uint8Array(t)}var Kl=Me({prefix:"\u{1F680}",name:"base256emoji",encode:Nl,decode:Dl});var Qo={};St(Qo,{base64:()=>Ol,base64pad:()=>Ml,base64url:()=>Jo,base64urlpad:()=>Hl});var Ol=ut({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Ml=ut({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Jo=ut({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Hl=ut({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var ts={};St(ts,{base8:()=>ql});var ql=ut({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var es={};St(es,{identity:()=>Vl});var Vl=Me({prefix:"\0",name:"identity",encode:r=>Mi(r),decode:r=>Oi(r)});var O0=new TextEncoder,M0=new TextDecoder;var os={};St(os,{sha256:()=>br,sha512:()=>Gl});function ns({name:r,code:t,encode:e}){return new rs(r,t,e)}var rs=class{name;code;encode;constructor(t,e,n){this.name=t,this.code=e,this.encode=n}digest(t){if(t instanceof Uint8Array){let e=this.encode(t);return e instanceof Uint8Array?kt(this.code,e):e.then(n=>kt(this.code,n))}else throw Error("Unknown type, must be binary type")}};function Ra(r){return async t=>new Uint8Array(await crypto.subtle.digest(r,t))}var br=ns({name:"sha2-256",code:18,encode:Ra("SHA-256")}),Gl=ns({name:"sha2-512",code:19,encode:Ra("SHA-512")});var _e={...es,...Xo,...ts,...Zo,...jo,...fo,...lo,...uo,...Qo,...Yo},Y0={...os,...yo};function ka(r,t,e,n){return{name:r,prefix:t,encoder:{name:r,prefix:t,encode:e},decoder:{decode:n}}}var Pa=ka("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),ss=ka("ascii","a",r=>{let t="a";for(let e=0;e<r.length;e++)t+=String.fromCharCode(r[e]);return t},r=>{r=r.substring(1);let t=pt(r.length);for(let e=0;e<r.length;e++)t[e]=r.charCodeAt(e);return t}),Wl={utf8:Pa,"utf-8":Pa,hex:_e.base16,latin1:ss,ascii:ss,binary:ss,..._e},dn=Wl;function tt(r,t="utf8"){let e=dn[t];if(e==null)throw new Error(`Unsupported encoding "${t}"`);return e.decoder.decode(`${e.prefix}${r}`)}function is(r){let t=r??8192,e=t>>>1,n,o=t;return function(i){if(i<1||i>e)return pt(i);o+i>t&&(n=pt(t),o=0);let a=n.subarray(o,o+=i);return(o&7)!==0&&(o=(o|7)+1),a}}var Ce=class{fn;len;next;val;constructor(t,e,n){this.fn=t,this.len=e,this.next=void 0,this.val=n}};function as(){}var us=class{head;tail;len;next;constructor(t){this.head=t.head,this.tail=t.tail,this.len=t.len,this.next=t.states}},$l=is();function Zl(r){return globalThis.Buffer!=null?pt(r):$l(r)}var Sr=class{len;head;tail;states;constructor(){this.len=0,this.head=new Ce(as,0,0),this.tail=this.head,this.states=null}_push(t,e,n){return this.tail=this.tail.next=new Ce(t,e,n),this.len+=e,this}uint32(t){return this.len+=(this.tail=this.tail.next=new fs((t=t>>>0)<128?1:t<16384?2:t<2097152?3:t<268435456?4:5,t)).len,this}int32(t){return t<0?this._push(pn,10,Pt.fromNumber(t)):this.uint32(t)}sint32(t){return this.uint32((t<<1^t>>31)>>>0)}uint64(t){let e=Pt.fromBigInt(t);return this._push(pn,e.length(),e)}uint64Number(t){return this._push(qo,ft(t),t)}uint64String(t){return this.uint64(BigInt(t))}int64(t){return this.uint64(t)}int64Number(t){return this.uint64Number(t)}int64String(t){return this.uint64String(t)}sint64(t){let e=Pt.fromBigInt(t).zzEncode();return this._push(pn,e.length(),e)}sint64Number(t){let e=Pt.fromNumber(t).zzEncode();return this._push(pn,e.length(),e)}sint64String(t){return this.sint64(BigInt(t))}bool(t){return this._push(cs,1,t?1:0)}fixed32(t){return this._push(Er,4,t>>>0)}sfixed32(t){return this.fixed32(t)}fixed64(t){let e=Pt.fromBigInt(t);return this._push(Er,4,e.lo)._push(Er,4,e.hi)}fixed64Number(t){let e=Pt.fromNumber(t);return this._push(Er,4,e.lo)._push(Er,4,e.hi)}fixed64String(t){return this.fixed64(BigInt(t))}sfixed64(t){return this.fixed64(t)}sfixed64Number(t){return this.fixed64Number(t)}sfixed64String(t){return this.fixed64String(t)}float(t){return this._push(Sa,4,t)}double(t){return this._push(va,8,t)}bytes(t){let e=t.length>>>0;return e===0?this._push(cs,1,0):this.uint32(e)._push(Xl,e,t)}string(t){let e=La(t);return e!==0?this.uint32(e)._push(Go,e,t):this._push(cs,1,0)}fork(){return this.states=new us(this),this.head=this.tail=new Ce(as,0,0),this.len=0,this}reset(){return this.states!=null?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Ce(as,0,0),this.len=0),this}ldelim(){let t=this.head,e=this.tail,n=this.len;return this.reset().uint32(n),n!==0&&(this.tail.next=t.next,this.tail=e,this.len+=n),this}finish(){let t=this.head.next,e=Zl(this.len),n=0;for(;t!=null;)t.fn(t.val,e,n),n+=t.len,t=t.next;return e}};function cs(r,t,e){t[e]=r&255}function jl(r,t,e){for(;r>127;)t[e++]=r&127|128,r>>>=7;t[e]=r}var fs=class extends Ce{next;constructor(t,e){super(jl,t,e),this.next=void 0}};function pn(r,t,e){for(;r.hi!==0;)t[e++]=r.lo&127|128,r.lo=(r.lo>>>7|r.hi<<25)>>>0,r.hi>>>=7;for(;r.lo>127;)t[e++]=r.lo&127|128,r.lo=r.lo>>>7;t[e++]=r.lo}function Er(r,t,e){t[e]=r&255,t[e+1]=r>>>8&255,t[e+2]=r>>>16&255,t[e+3]=r>>>24}function Xl(r,t,e){t.set(r,e)}globalThis.Buffer!=null&&(Sr.prototype.bytes=function(r){let t=r.length>>>0;return this.uint32(t),t>0&&this._push(Yl,t,r),this},Sr.prototype.string=function(r){let t=globalThis.Buffer.byteLength(r);return this.uint32(t),t>0&&this._push(Jl,t,r),this});function Yl(r,t,e){t.set(r,e)}function Jl(r,t,e){r.length<40?Go(r,t,e):t.utf8Write!=null?t.utf8Write(r,e):t.set(tt(r),e)}function ls(){return new Sr}function Ue(r,t){let e=ls();return t.encode(r,e,{lengthDelimited:!1}),e.finish()}var je;(function(r){r[r.VARINT=0]="VARINT",r[r.BIT64=1]="BIT64",r[r.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",r[r.START_GROUP=3]="START_GROUP",r[r.END_GROUP=4]="END_GROUP",r[r.BIT32=5]="BIT32"})(je||(je={}));function mn(r,t,e,n){return{name:r,type:t,encode:e,decode:n}}function hs(r){function t(o){if(r[o.toString()]==null)throw new Error("Invalid enum value");return r[o]}let e=function(s,i){let a=t(s);i.int32(a)},n=function(s){let i=s.int32();return t(i)};return mn("enum",je.VARINT,e,n)}function Re(r,t){return mn("message",je.LENGTH_DELIMITED,r,t)}var mt;(function(r){r.RSA="RSA",r.Ed25519="Ed25519",r.secp256k1="secp256k1"})(mt||(mt={}));var ds;(function(r){r[r.RSA=0]="RSA",r[r.Ed25519=1]="Ed25519",r[r.secp256k1=2]="secp256k1"})(ds||(ds={}));(function(r){r.codec=()=>hs(ds)})(mt||(mt={}));var Wt;(function(r){let t;r.codec=()=>(t==null&&(t=Re((e,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),e.Type!=null&&(n.uint32(8),mt.codec().encode(e.Type,n)),e.Data!=null&&(n.uint32(18),n.bytes(e.Data)),o.lengthDelimited!==!1&&n.ldelim()},(e,n,o={})=>{let s={},i=n==null?e.len:e.pos+n;for(;e.pos<i;){let a=e.uint32();switch(a>>>3){case 1:{s.Type=mt.codec().decode(e);break}case 2:{s.Data=e.bytes();break}default:{e.skipType(a&7);break}}}return s})),t),r.encode=e=>Ue(e,r.codec()),r.decode=(e,n)=>Te(e,r.codec(),n)})(Wt||(Wt={}));var ps;(function(r){let t;r.codec=()=>(t==null&&(t=Re((e,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),e.Type!=null&&(n.uint32(8),mt.codec().encode(e.Type,n)),e.Data!=null&&(n.uint32(18),n.bytes(e.Data)),o.lengthDelimited!==!1&&n.ldelim()},(e,n,o={})=>{let s={},i=n==null?e.len:e.pos+n;for(;e.pos<i;){let a=e.uint32();switch(a>>>3){case 1:{s.Type=mt.codec().decode(e);break}case 2:{s.Data=e.bytes();break}default:{e.skipType(a&7);break}}}return s})),t),r.encode=e=>Ue(e,r.codec()),r.decode=(e,n)=>Te(e,r.codec(),n)})(ps||(ps={}));var Br={};St(Br,{MAX_RSA_KEY_SIZE:()=>xs,generateRSAKeyPair:()=>ja,jwkToJWKKeyPair:()=>Xa,jwkToPkcs1:()=>lh,jwkToPkix:()=>Es,jwkToRSAPrivateKey:()=>Za,pkcs1ToJwk:()=>Ga,pkcs1ToRSAPrivateKey:()=>$a,pkixToJwk:()=>Wa,pkixToRSAPublicKey:()=>Ss});var Ql=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),ge=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),we=new Uint32Array(64),ms=class extends Ge{constructor(){super(64,32,8,!1),this.A=ge[0]|0,this.B=ge[1]|0,this.C=ge[2]|0,this.D=ge[3]|0,this.E=ge[4]|0,this.F=ge[5]|0,this.G=ge[6]|0,this.H=ge[7]|0}get(){let{A:t,B:e,C:n,D:o,E:s,F:i,G:a,H:c}=this;return[t,e,n,o,s,i,a,c]}set(t,e,n,o,s,i,a,c){this.A=t|0,this.B=e|0,this.C=n|0,this.D=o|0,this.E=s|0,this.F=i|0,this.G=a|0,this.H=c|0}process(t,e){for(let l=0;l<16;l++,e+=4)we[l]=t.getUint32(e,!1);for(let l=16;l<64;l++){let d=we[l-15],g=we[l-2],w=Kt(d,7)^Kt(d,18)^d>>>3,m=Kt(g,17)^Kt(g,19)^g>>>10;we[l]=m+we[l-7]+w+we[l-16]|0}let{A:n,B:o,C:s,D:i,E:a,F:c,G:f,H:u}=this;for(let l=0;l<64;l++){let d=Kt(a,6)^Kt(a,11)^Kt(a,25),g=u+d+Qi(a,c,f)+Ql[l]+we[l]|0,m=(Kt(n,2)^Kt(n,13)^Kt(n,22))+ta(n,o,s)|0;u=f,f=c,c=a,a=i+g|0,i=s,s=o,o=n,n=g+m|0}n=n+this.A|0,o=o+this.B|0,s=s+this.C|0,i=i+this.D|0,a=a+this.E|0,c=c+this.F|0,f=f+this.G|0,u=u+this.H|0,this.set(n,o,s,i,a,c,f,u)}roundClean(){we.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var $t=Qr(()=>new ms);function F(r,t="utf8"){let e=dn[t];if(e==null)throw new Error(`Unsupported encoding "${t}"`);return e.encoder.encode(r).substring(1)}function Bt(r,t){t==null&&(t=r.reduce((o,s)=>o+s.length,0));let e=pt(t),n=0;for(let o of r)e.set(o,n),n+=o.length;return e}var Ka=Symbol.for("@achingbrain/uint8arraylist");function Da(r,t){if(t==null||t<0)throw new RangeError("index is out of bounds");let e=0;for(let n of r){let o=e+n.byteLength;if(t<o)return{buf:n,index:t-e};e=o}throw new RangeError("index is out of bounds")}function yn(r){return!!r?.[Ka]}var Z=class r{bufs;length;[Ka]=!0;constructor(...t){this.bufs=[],this.length=0,t.length>0&&this.appendAll(t)}*[Symbol.iterator](){yield*this.bufs}get byteLength(){return this.length}append(...t){this.appendAll(t)}appendAll(t){let e=0;for(let n of t)if(n instanceof Uint8Array)e+=n.byteLength,this.bufs.push(n);else if(yn(n))e+=n.byteLength,this.bufs.push(...n.bufs);else throw new Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");this.length+=e}prepend(...t){this.prependAll(t)}prependAll(t){let e=0;for(let n of t.reverse())if(n instanceof Uint8Array)e+=n.byteLength,this.bufs.unshift(n);else if(yn(n))e+=n.byteLength,this.bufs.unshift(...n.bufs);else throw new Error("Could not prepend value, must be an Uint8Array or a Uint8ArrayList");this.length+=e}get(t){let e=Da(this.bufs,t);return e.buf[e.index]}set(t,e){let n=Da(this.bufs,t);n.buf[n.index]=e}write(t,e=0){if(t instanceof Uint8Array)for(let n=0;n<t.length;n++)this.set(e+n,t[n]);else if(yn(t))for(let n=0;n<t.length;n++)this.set(e+n,t.get(n));else throw new Error("Could not write value, must be an Uint8Array or a Uint8ArrayList")}consume(t){if(t=Math.trunc(t),!(Number.isNaN(t)||t<=0)){if(t===this.byteLength){this.bufs=[],this.length=0;return}for(;this.bufs.length>0;)if(t>=this.bufs[0].byteLength)t-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift();else{this.bufs[0]=this.bufs[0].subarray(t),this.length-=t;break}}}slice(t,e){let{bufs:n,length:o}=this._subList(t,e);return Bt(n,o)}subarray(t,e){let{bufs:n,length:o}=this._subList(t,e);return n.length===1?n[0]:Bt(n,o)}sublist(t,e){let{bufs:n,length:o}=this._subList(t,e),s=new r;return s.length=o,s.bufs=[...n],s}_subList(t,e){if(t=t??0,e=e??this.length,t<0&&(t=this.length+t),e<0&&(e=this.length+e),t<0||e>this.length)throw new RangeError("index is out of bounds");if(t===e)return{bufs:[],length:0};if(t===0&&e===this.length)return{bufs:this.bufs,length:this.length};let n=[],o=0;for(let s=0;s<this.bufs.length;s++){let i=this.bufs[s],a=o,c=a+i.byteLength;if(o=c,t>=c)continue;let f=t>=a&&t<c,u=e>a&&e<=c;if(f&&u){if(t===a&&e===c){n.push(i);break}let l=t-a;n.push(i.subarray(l,l+(e-t)));break}if(f){if(t===0){n.push(i);continue}n.push(i.subarray(t-a));continue}if(u){if(e===c){n.push(i);break}n.push(i.subarray(0,e-a));break}n.push(i)}return{bufs:n,length:e-t}}indexOf(t,e=0){if(!yn(t)&&!(t instanceof Uint8Array))throw new TypeError('The "value" argument must be a Uint8ArrayList or Uint8Array');let n=t instanceof Uint8Array?t:t.subarray();if(e=Number(e??0),isNaN(e)&&(e=0),e<0&&(e=this.length+e),e<0&&(e=0),t.length===0)return e>this.length?this.length:e;let o=n.byteLength;if(o===0)throw new TypeError("search must be at least 1 byte long");let s=256,i=new Int32Array(s);for(let l=0;l<s;l++)i[l]=-1;for(let l=0;l<o;l++)i[n[l]]=l;let a=i,c=this.byteLength-n.byteLength,f=n.byteLength-1,u;for(let l=e;l<=c;l+=u){u=0;for(let d=f;d>=0;d--){let g=this.get(l+d);if(n[d]!==g){u=Math.max(1,d-a[g]);break}}if(u===0)return l}return-1}getInt8(t){let e=this.subarray(t,t+1);return new DataView(e.buffer,e.byteOffset,e.byteLength).getInt8(0)}setInt8(t,e){let n=pt(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setInt8(0,e),this.write(n,t)}getInt16(t,e){let n=this.subarray(t,t+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt16(0,e)}setInt16(t,e,n){let o=dt(2);new DataView(o.buffer,o.byteOffset,o.byteLength).setInt16(0,e,n),this.write(o,t)}getInt32(t,e){let n=this.subarray(t,t+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt32(0,e)}setInt32(t,e,n){let o=dt(4);new DataView(o.buffer,o.byteOffset,o.byteLength).setInt32(0,e,n),this.write(o,t)}getBigInt64(t,e){let n=this.subarray(t,t+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigInt64(0,e)}setBigInt64(t,e,n){let o=dt(8);new DataView(o.buffer,o.byteOffset,o.byteLength).setBigInt64(0,e,n),this.write(o,t)}getUint8(t){let e=this.subarray(t,t+1);return new DataView(e.buffer,e.byteOffset,e.byteLength).getUint8(0)}setUint8(t,e){let n=pt(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setUint8(0,e),this.write(n,t)}getUint16(t,e){let n=this.subarray(t,t+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint16(0,e)}setUint16(t,e,n){let o=dt(2);new DataView(o.buffer,o.byteOffset,o.byteLength).setUint16(0,e,n),this.write(o,t)}getUint32(t,e){let n=this.subarray(t,t+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint32(0,e)}setUint32(t,e,n){let o=dt(4);new DataView(o.buffer,o.byteOffset,o.byteLength).setUint32(0,e,n),this.write(o,t)}getBigUint64(t,e){let n=this.subarray(t,t+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigUint64(0,e)}setBigUint64(t,e,n){let o=dt(8);new DataView(o.buffer,o.byteOffset,o.byteLength).setBigUint64(0,e,n),this.write(o,t)}getFloat32(t,e){let n=this.subarray(t,t+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat32(0,e)}setFloat32(t,e,n){let o=dt(4);new DataView(o.buffer,o.byteOffset,o.byteLength).setFloat32(0,e,n),this.write(o,t)}getFloat64(t,e){let n=this.subarray(t,t+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat64(0,e)}setFloat64(t,e,n){let o=dt(8);new DataView(o.buffer,o.byteOffset,o.byteLength).setFloat64(0,e,n),this.write(o,t)}equals(t){if(t==null||!(t instanceof r)||t.bufs.length!==this.bufs.length)return!1;for(let e=0;e<this.bufs.length;e++)if(!wt(this.bufs[e],t.bufs[e]))return!1;return!0}static fromUint8Arrays(t,e){let n=new r;return n.bufs=t,e==null&&(e=t.reduce((o,s)=>o+s.byteLength,0)),n.length=e,n}};var eh=parseInt("11111",2),gs=parseInt("10000000",2),rh=parseInt("01111111",2),Oa={2:nh,3:ih,5:sh,6:oh,16:ys,22:ys,48:ys};function Ar(r,t={offset:0}){let e=r[t.offset]&eh;if(t.offset++,Oa[e]!=null)return Oa[e](r,t);throw new Error("No decoder for tag "+e)}function gn(r,t){let e=0;if((r[t.offset]&gs)===gs){let n=r[t.offset]&rh,o="0x";t.offset++;for(let s=0;s<n;s++,t.offset++)o+=r[t.offset].toString(16).padStart(2,"0");e=parseInt(o,16)}else e=r[t.offset],t.offset++;return e}function ys(r,t){gn(r,t);let e=[];for(;!(t.offset>=r.byteLength);){let n=Ar(r,t);if(n===null)break;e.push(n)}return e}function nh(r,t){let e=gn(r,t),n=t.offset,o=t.offset+e,s=[];for(let i=n;i<o;i++)i===n&&r[i]===0||s.push(r[i]);return t.offset+=e,Uint8Array.from(s)}function oh(r,t){let e=gn(r,t);return t.offset+=e,["oid-unimplemented"]}function sh(r,t){return t.offset++,null}function ih(r,t){let e=gn(r,t),n=r[t.offset];t.offset++;let o=r.subarray(t.offset,t.offset+e);if(t.offset+=e,n!==0)throw new Error("Unused bits in bit string is unimplemented");return Ar(o,{offset:0})}function ah(r){let t=r.toString(16);t.length%2===1&&(t="0"+t);let e=new Z;for(let n=0;n<t.length;n+=2)e.append(Uint8Array.from([parseInt(`${t[n]}${t[n+1]}`,16)]));return e}function ws(r){if(r.byteLength<128)return Uint8Array.from([r.byteLength]);let t=ah(r.byteLength);return new Z(Uint8Array.from([t.byteLength|gs]),t)}function Dt(r){let t=new Z,e=parseInt("10000000",2);return(r.subarray()[0]&e)===e&&t.append(Uint8Array.from([0])),t.append(r),new Z(Uint8Array.from([2]),ws(t),t)}function Ma(r){let t=Uint8Array.from([0]),e=new Z(t,r);return new Z(Uint8Array.from([3]),ws(e),e)}function wn(r){let t=new Z;for(let e of r)t.append(e);return new Z(Uint8Array.from([48]),ws(t),t)}var vr=class extends Error{constructor(t="An error occurred while verifying a message"){super(t),this.name="VerificationError"}},xn=class extends Error{constructor(t="Missing Web Crypto API"){super(t),this.name="WebCryptoMissingError"}};var Ha={get(r=globalThis){let t=r.crypto;if(t?.subtle==null)throw new xn("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p/blob/main/packages/crypto/README.md#web-crypto-api");return t}};var xe=Ha;async function qa(r){let t=await xe.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:r,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]),e=await ch(t);return{privateKey:e[0],publicKey:e[1]}}async function Va(r,t){let e=await xe.get().subtle.importKey("jwk",r,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]),n=await xe.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},e,t instanceof Uint8Array?t:t.subarray());return new Uint8Array(n,0,n.byteLength)}async function Fa(r,t,e){let n=await xe.get().subtle.importKey("jwk",r,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);return xe.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},n,t,e instanceof Uint8Array?e:e.subarray())}async function ch(r){if(r.privateKey==null||r.publicKey==null)throw new yt("Private and public key are required");return Promise.all([xe.get().subtle.exportKey("jwk",r.privateKey),xe.get().subtle.exportKey("jwk",r.publicKey)])}function za(r){if(r.kty!=="RSA")throw new yt("invalid key type");if(r.n==null)throw new yt("invalid key modulus");return tt(r.n,"base64url").length*8}var Xe=class{type="RSA";_key;_raw;_multihash;constructor(t,e){this._key=t,this._multihash=e}get raw(){return this._raw==null&&(this._raw=Br.jwkToPkix(this._key)),this._raw}toMultihash(){return this._multihash}toCID(){return lt.createV1(114,this._multihash)}toString(){return et.encode(this.toMultihash().bytes).substring(1)}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:wt(this.raw,t.raw)}verify(t,e){return Fa(this._key,e,t)}},Ir=class{type="RSA";_key;_raw;publicKey;constructor(t,e){this._key=t,this.publicKey=e}get raw(){return this._raw==null&&(this._raw=Br.jwkToPkcs1(this._key)),this._raw}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:wt(this.raw,t.raw)}sign(t){return Va(this._key,t)}};var xs=8192,bs=18,uh=1062,fh=Uint8Array.from([48,13,6,9,42,134,72,134,247,13,1,1,1,5,0]);function Ga(r){let t=Ar(r);return{n:F(t[1],"base64url"),e:F(t[2],"base64url"),d:F(t[3],"base64url"),p:F(t[4],"base64url"),q:F(t[5],"base64url"),dp:F(t[6],"base64url"),dq:F(t[7],"base64url"),qi:F(t[8],"base64url"),kty:"RSA"}}function lh(r){if(r.n==null||r.e==null||r.d==null||r.p==null||r.q==null||r.dp==null||r.dq==null||r.qi==null)throw new yt("JWK was missing components");return wn([Dt(Uint8Array.from([0])),Dt(tt(r.n,"base64url")),Dt(tt(r.e,"base64url")),Dt(tt(r.d,"base64url")),Dt(tt(r.p,"base64url")),Dt(tt(r.q,"base64url")),Dt(tt(r.dp,"base64url")),Dt(tt(r.dq,"base64url")),Dt(tt(r.qi,"base64url"))]).subarray()}function Wa(r){let t=Ar(r,{offset:0});return{kty:"RSA",n:F(t[1][0],"base64url"),e:F(t[1][1],"base64url")}}function Es(r){if(r.n==null||r.e==null)throw new yt("JWK was missing components");return wn([fh,Ma(wn([Dt(tt(r.n,"base64url")),Dt(tt(r.e,"base64url"))]))]).subarray()}function $a(r){let t=Ga(r);return Za(t)}function Ss(r,t){if(r.byteLength>=uh)throw new Oe("Key size is too large");let e=Wa(r);if(t==null){let n=$t(Wt.encode({Type:mt.RSA,Data:r}));t=kt(bs,n)}return new Xe(e,t)}function Za(r){if(za(r)>xs)throw new yt("Key size is too large");let t=Xa(r),e=$t(Wt.encode({Type:mt.RSA,Data:Es(t.publicKey)})),n=kt(bs,e);return new Ir(t.privateKey,new Xe(t.publicKey,n))}async function ja(r){if(r>xs)throw new yt("Key size is too large");let t=await qa(r),e=$t(Wt.encode({Type:mt.RSA,Data:Es(t.publicKey)})),n=kt(bs,e);return new Ir(t.privateKey,new Xe(t.publicKey,n))}function Xa(r){if(r==null)throw new yt("Missing key parameter");return{privateKey:r,publicKey:{kty:r.kty,n:r.n,e:r.e}}}var bn=class extends ze{constructor(t,e){super(),this.finished=!1,this.destroyed=!1,hr(t);let n=fe(e);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let o=this.blockLen,s=new Uint8Array(o);s.set(n.length>o?t.create().update(n).digest():n);for(let i=0;i<s.length;i++)s[i]^=54;this.iHash.update(s),this.oHash=t.create();for(let i=0;i<s.length;i++)s[i]^=106;this.oHash.update(s),s.fill(0)}update(t){return Fe(this),this.iHash.update(t),this}digestInto(t){Fe(this),Ve(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){let t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));let{oHash:e,iHash:n,finished:o,destroyed:s,blockLen:i,outputLen:a}=this;return t=t,t.finished=o,t.destroyed=s,t.blockLen=i,t.outputLen=a,t.oHash=e._cloneInto(t.oHash),t.iHash=n._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},Ye=(r,t,e)=>new bn(r,t).update(e).digest();Ye.create=(r,t)=>new bn(r,t);function Ya(r){r.lowS!==void 0&&Ot("lowS",r.lowS),r.prehash!==void 0&&Ot("prehash",r.prehash)}function hh(r){let t=yr(r);Nt(t,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});let{endo:e,Fp:n,a:o}=t;if(e){if(!n.eql(o,n.ZERO))throw new Error("invalid endomorphism, can only be defined for Koblitz curves that have a=0");if(typeof e!="object"||typeof e.beta!="bigint"||typeof e.splitScalar!="function")throw new Error("invalid endomorphism, expected beta: bigint and splitScalar: function")}return Object.freeze({...t})}var{bytesToNumberBE:dh,hexToBytes:ph}=nn,As=class extends Error{constructor(t=""){super(t)}},ne={Err:As,_tlv:{encode:(r,t)=>{let{Err:e}=ne;if(r<0||r>256)throw new e("tlv.encode: wrong tag");if(t.length&1)throw new e("tlv.encode: unpadded data");let n=t.length/2,o=Ae(n);if(o.length/2&128)throw new e("tlv.encode: long form length too big");let s=n>127?Ae(o.length/2|128):"";return Ae(r)+s+o+t},decode(r,t){let{Err:e}=ne,n=0;if(r<0||r>256)throw new e("tlv.encode: wrong tag");if(t.length<2||t[n++]!==r)throw new e("tlv.decode: wrong tlv");let o=t[n++],s=!!(o&128),i=0;if(!s)i=o;else{let c=o&127;if(!c)throw new e("tlv.decode(long): indefinite length not supported");if(c>4)throw new e("tlv.decode(long): byte length is too big");let f=t.subarray(n,n+c);if(f.length!==c)throw new e("tlv.decode: length bytes not complete");if(f[0]===0)throw new e("tlv.decode(long): zero leftmost byte");for(let u of f)i=i<<8|u;if(n+=c,i<128)throw new e("tlv.decode(long): not minimal encoding")}let a=t.subarray(n,n+i);if(a.length!==i)throw new e("tlv.decode: wrong value length");return{v:a,l:t.subarray(n+i)}}},_int:{encode(r){let{Err:t}=ne;if(r<oe)throw new t("integer: negative integers are not allowed");let e=Ae(r);if(Number.parseInt(e[0],16)&8&&(e="00"+e),e.length&1)throw new t("unexpected DER parsing assertion: unpadded hex");return e},decode(r){let{Err:t}=ne;if(r[0]&128)throw new t("invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new t("invalid signature integer: unnecessary leading zero");return dh(r)}},toSig(r){let{Err:t,_int:e,_tlv:n}=ne,o=typeof r=="string"?ph(r):r;We(o);let{v:s,l:i}=n.decode(48,o);if(i.length)throw new t("invalid signature: left bytes after parsing");let{v:a,l:c}=n.decode(2,s),{v:f,l:u}=n.decode(2,c);if(u.length)throw new t("invalid signature: left bytes after parsing");return{r:e.decode(a),s:e.decode(f)}},hexFromSig(r){let{_tlv:t,_int:e}=ne,n=t.encode(2,e.encode(r.r)),o=t.encode(2,e.encode(r.s)),s=n+o;return t.encode(48,s)}},oe=BigInt(0),gt=BigInt(1),wy=BigInt(2),Ja=BigInt(3),xy=BigInt(4);function mh(r){let t=hh(r),{Fp:e}=t,n=me(t.n,t.nBitLength),o=t.toBytes||((m,h,x)=>{let E=h.toAffine();return re(Uint8Array.from([4]),e.toBytes(E.x),e.toBytes(E.y))}),s=t.fromBytes||(m=>{let h=m.subarray(1),x=e.fromBytes(h.subarray(0,e.BYTES)),E=e.fromBytes(h.subarray(e.BYTES,2*e.BYTES));return{x,y:E}});function i(m){let{a:h,b:x}=t,E=e.sqr(m),p=e.mul(E,m);return e.add(e.add(p,e.mul(m,h)),x)}if(!e.eql(e.sqr(t.Gy),i(t.Gx)))throw new Error("bad generator point: equation left != right");function a(m){return pr(m,gt,t.n)}function c(m){let{allowedPrivateKeyLengths:h,nByteLength:x,wrapPrivateKey:E,n:p}=t;if(h&&typeof m!="bigint"){if(de(m)&&(m=Qt(m)),typeof m!="string"||!h.includes(m.length))throw new Error("invalid private key");m=m.padStart(x*2,"0")}let I;try{I=typeof m=="bigint"?m:te(rt("private key",m,x))}catch{throw new Error("invalid private key, expected hex or "+x+" bytes, got "+typeof m)}return E&&(I=j(I,p)),xt("private key",I,gt,p),I}function f(m){if(!(m instanceof d))throw new Error("ProjectivePoint expected")}let u=Be((m,h)=>{let{px:x,py:E,pz:p}=m;if(e.eql(p,e.ONE))return{x,y:E};let I=m.is0();h==null&&(h=I?e.ONE:e.inv(p));let U=e.mul(x,h),C=e.mul(E,h),T=e.mul(p,h);if(I)return{x:e.ZERO,y:e.ZERO};if(!e.eql(T,e.ONE))throw new Error("invZ was invalid");return{x:U,y:C}}),l=Be(m=>{if(m.is0()){if(t.allowInfinityPoint&&!e.is0(m.py))return;throw new Error("bad point: ZERO")}let{x:h,y:x}=m.toAffine();if(!e.isValid(h)||!e.isValid(x))throw new Error("bad point: x or y not FE");let E=e.sqr(x),p=i(h);if(!e.eql(E,p))throw new Error("bad point: equation left != right");if(!m.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class d{constructor(h,x,E){if(this.px=h,this.py=x,this.pz=E,h==null||!e.isValid(h))throw new Error("x required");if(x==null||!e.isValid(x))throw new Error("y required");if(E==null||!e.isValid(E))throw new Error("z required");Object.freeze(this)}static fromAffine(h){let{x,y:E}=h||{};if(!h||!e.isValid(x)||!e.isValid(E))throw new Error("invalid affine point");if(h instanceof d)throw new Error("projective point not allowed");let p=I=>e.eql(I,e.ZERO);return p(x)&&p(E)?d.ZERO:new d(x,E,e.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(h){let x=e.invertBatch(h.map(E=>E.pz));return h.map((E,p)=>E.toAffine(x[p])).map(d.fromAffine)}static fromHex(h){let x=d.fromAffine(s(rt("pointHex",h)));return x.assertValidity(),x}static fromPrivateKey(h){return d.BASE.multiply(c(h))}static msm(h,x){return cn(d,n,h,x)}_setWindowSize(h){w.setWindowSize(this,h)}assertValidity(){l(this)}hasEvenY(){let{y:h}=this.toAffine();if(e.isOdd)return!e.isOdd(h);throw new Error("Field doesn't support isOdd")}equals(h){f(h);let{px:x,py:E,pz:p}=this,{px:I,py:U,pz:C}=h,T=e.eql(e.mul(x,C),e.mul(I,p)),_=e.eql(e.mul(E,C),e.mul(U,p));return T&&_}negate(){return new d(this.px,e.neg(this.py),this.pz)}double(){let{a:h,b:x}=t,E=e.mul(x,Ja),{px:p,py:I,pz:U}=this,C=e.ZERO,T=e.ZERO,_=e.ZERO,B=e.mul(p,p),O=e.mul(I,I),k=e.mul(U,U),K=e.mul(p,I);return K=e.add(K,K),_=e.mul(p,U),_=e.add(_,_),C=e.mul(h,_),T=e.mul(E,k),T=e.add(C,T),C=e.sub(O,T),T=e.add(O,T),T=e.mul(C,T),C=e.mul(K,C),_=e.mul(E,_),k=e.mul(h,k),K=e.sub(B,k),K=e.mul(h,K),K=e.add(K,_),_=e.add(B,B),B=e.add(_,B),B=e.add(B,k),B=e.mul(B,K),T=e.add(T,B),k=e.mul(I,U),k=e.add(k,k),B=e.mul(k,K),C=e.sub(C,B),_=e.mul(k,O),_=e.add(_,_),_=e.add(_,_),new d(C,T,_)}add(h){f(h);let{px:x,py:E,pz:p}=this,{px:I,py:U,pz:C}=h,T=e.ZERO,_=e.ZERO,B=e.ZERO,O=t.a,k=e.mul(t.b,Ja),K=e.mul(x,I),H=e.mul(E,U),v=e.mul(p,C),L=e.add(x,E),b=e.add(I,U);L=e.mul(L,b),b=e.add(K,H),L=e.sub(L,b),b=e.add(x,p);let y=e.add(I,C);return b=e.mul(b,y),y=e.add(K,v),b=e.sub(b,y),y=e.add(E,p),T=e.add(U,C),y=e.mul(y,T),T=e.add(H,v),y=e.sub(y,T),B=e.mul(O,b),T=e.mul(k,v),B=e.add(T,B),T=e.sub(H,B),B=e.add(H,B),_=e.mul(T,B),H=e.add(K,K),H=e.add(H,K),v=e.mul(O,v),b=e.mul(k,b),H=e.add(H,v),v=e.sub(K,v),v=e.mul(O,v),b=e.add(b,v),K=e.mul(H,b),_=e.add(_,K),K=e.mul(y,b),T=e.mul(L,T),T=e.sub(T,K),K=e.mul(L,H),B=e.mul(y,B),B=e.add(B,K),new d(T,_,B)}subtract(h){return this.add(h.negate())}is0(){return this.equals(d.ZERO)}wNAF(h){return w.wNAFCached(this,h,d.normalizeZ)}multiplyUnsafe(h){let{endo:x,n:E}=t;xt("scalar",h,oe,E);let p=d.ZERO;if(h===oe)return p;if(this.is0()||h===gt)return this;if(!x||w.hasPrecomputes(this))return w.wNAFCachedUnsafe(this,h,d.normalizeZ);let{k1neg:I,k1:U,k2neg:C,k2:T}=x.splitScalar(h),_=p,B=p,O=this;for(;U>oe||T>oe;)U&gt&&(_=_.add(O)),T&gt&&(B=B.add(O)),O=O.double(),U>>=gt,T>>=gt;return I&&(_=_.negate()),C&&(B=B.negate()),B=new d(e.mul(B.px,x.beta),B.py,B.pz),_.add(B)}multiply(h){let{endo:x,n:E}=t;xt("scalar",h,gt,E);let p,I;if(x){let{k1neg:U,k1:C,k2neg:T,k2:_}=x.splitScalar(h),{p:B,f:O}=this.wNAF(C),{p:k,f:K}=this.wNAF(_);B=w.constTimeNegate(U,B),k=w.constTimeNegate(T,k),k=new d(e.mul(k.px,x.beta),k.py,k.pz),p=B.add(k),I=O.add(K)}else{let{p:U,f:C}=this.wNAF(h);p=U,I=C}return d.normalizeZ([p,I])[0]}multiplyAndAddUnsafe(h,x,E){let p=d.BASE,I=(C,T)=>T===oe||T===gt||!C.equals(p)?C.multiplyUnsafe(T):C.multiply(T),U=I(this,x).add(I(h,E));return U.is0()?void 0:U}toAffine(h){return u(this,h)}isTorsionFree(){let{h,isTorsionFree:x}=t;if(h===gt)return!0;if(x)return x(d,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){let{h,clearCofactor:x}=t;return h===gt?this:x?x(d,this):this.multiplyUnsafe(t.h)}toRawBytes(h=!0){return Ot("isCompressed",h),this.assertValidity(),o(d,this,h)}toHex(h=!0){return Ot("isCompressed",h),Qt(this.toRawBytes(h))}}d.BASE=new d(t.Gx,t.Gy,e.ONE),d.ZERO=new d(e.ZERO,e.ONE,e.ZERO);let g=t.nBitLength,w=an(d,t.endo?Math.ceil(g/2):g);return{CURVE:t,ProjectivePoint:d,normPrivateKeyToScalar:c,weierstrassEquation:i,isWithinCurveOrder:a}}function yh(r){let t=yr(r);return Nt(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}function Qa(r){let t=yh(r),{Fp:e,n}=t,o=e.BYTES+1,s=2*e.BYTES+1;function i(v){return j(v,n)}function a(v){return on(v,n)}let{ProjectivePoint:c,normPrivateKeyToScalar:f,weierstrassEquation:u,isWithinCurveOrder:l}=mh({...t,toBytes(v,L,b){let y=L.toAffine(),A=e.toBytes(y.x),S=re;return Ot("isCompressed",b),b?S(Uint8Array.from([L.hasEvenY()?2:3]),A):S(Uint8Array.from([4]),A,e.toBytes(y.y))},fromBytes(v){let L=v.length,b=v[0],y=v.subarray(1);if(L===o&&(b===2||b===3)){let A=te(y);if(!pr(A,gt,e.ORDER))throw new Error("Point is not on curve");let S=u(A),R;try{R=e.sqrt(S)}catch(q){let M=q instanceof Error?": "+q.message:"";throw new Error("Point is not on curve"+M)}let P=(R&gt)===gt;return(b&1)===1!==P&&(R=e.neg(R)),{x:A,y:R}}else if(L===s&&b===4){let A=e.fromBytes(y.subarray(0,e.BYTES)),S=e.fromBytes(y.subarray(e.BYTES,2*e.BYTES));return{x:A,y:S}}else{let A=o,S=s;throw new Error("invalid Point, expected length of "+A+", or uncompressed "+S+", got "+L)}}}),d=v=>Qt(pe(v,t.nByteLength));function g(v){let L=n>>gt;return v>L}function w(v){return g(v)?i(-v):v}let m=(v,L,b)=>te(v.slice(L,b));class h{constructor(L,b,y){this.r=L,this.s=b,this.recovery=y,this.assertValidity()}static fromCompact(L){let b=t.nByteLength;return L=rt("compactSignature",L,b*2),new h(m(L,0,b),m(L,b,2*b))}static fromDER(L){let{r:b,s:y}=ne.toSig(rt("DER",L));return new h(b,y)}assertValidity(){xt("r",this.r,gt,n),xt("s",this.s,gt,n)}addRecoveryBit(L){return new h(this.r,this.s,L)}recoverPublicKey(L){let{r:b,s:y,recovery:A}=this,S=C(rt("msgHash",L));if(A==null||![0,1,2,3].includes(A))throw new Error("recovery id invalid");let R=A===2||A===3?b+t.n:b;if(R>=e.ORDER)throw new Error("recovery id 2 or 3 invalid");let P=(A&1)===0?"02":"03",D=c.fromHex(P+d(R)),q=a(R),M=i(-S*q),z=i(y*q),$=c.BASE.multiplyAndAddUnsafe(D,M,z);if(!$)throw new Error("point at infinify");return $.assertValidity(),$}hasHighS(){return g(this.s)}normalizeS(){return this.hasHighS()?new h(this.r,i(-this.s),this.recovery):this}toDERRawBytes(){return ve(this.toDERHex())}toDERHex(){return ne.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return ve(this.toCompactHex())}toCompactHex(){return d(this.r)+d(this.s)}}let x={isValidPrivateKey(v){try{return f(v),!0}catch{return!1}},normPrivateKeyToScalar:f,randomPrivateKey:()=>{let v=_o(t.n);return ua(t.randomBytes(v),t.n)},precompute(v=8,L=c.BASE){return L._setWindowSize(v),L.multiply(BigInt(3)),L}};function E(v,L=!0){return c.fromPrivateKey(v).toRawBytes(L)}function p(v){let L=de(v),b=typeof v=="string",y=(L||b)&&v.length;return L?y===o||y===s:b?y===2*o||y===2*s:v instanceof c}function I(v,L,b=!0){if(p(v))throw new Error("first arg must be private key");if(!p(L))throw new Error("second arg must be public key");return c.fromHex(L).multiply(f(v)).toRawBytes(b)}let U=t.bits2int||function(v){if(v.length>8192)throw new Error("input is too large");let L=te(v),b=v.length*8-t.nBitLength;return b>0?L>>BigInt(b):L},C=t.bits2int_modN||function(v){return i(U(v))},T=mr(t.nBitLength);function _(v){return xt("num < 2^"+t.nBitLength,v,oe,T),pe(v,t.nByteLength)}function B(v,L,b=O){if(["recovered","canonical"].some(ot=>ot in b))throw new Error("sign() legacy options not supported");let{hash:y,randomBytes:A}=t,{lowS:S,prehash:R,extraEntropy:P}=b;S==null&&(S=!0),v=rt("msgHash",v),Ya(b),R&&(v=rt("prehashed msgHash",y(v)));let D=C(v),q=f(L),M=[_(q),_(D)];if(P!=null&&P!==!1){let ot=P===!0?A(e.BYTES):P;M.push(rt("extraEntropy",ot))}let z=re(...M),$=D;function nt(ot){let it=U(ot);if(!l(it))return;let Et=a(it),Ut=c.BASE.multiply(it).toAffine(),_t=i(Ut.x);if(_t===oe)return;let Ft=i(Et*i($+_t*q));if(Ft===oe)return;let Zt=(Ut.x===_t?0:2)|Number(Ut.y&gt),ar=Ft;return S&&g(Ft)&&(ar=w(Ft),Zt^=1),new h(_t,ar,Zt)}return{seed:z,k2sig:nt}}let O={lowS:t.lowS,prehash:!1},k={lowS:t.lowS,prehash:!1};function K(v,L,b=O){let{seed:y,k2sig:A}=B(v,L,b),S=t;return vo(S.hash.outputLen,S.nByteLength,S.hmac)(y,A)}c.BASE._setWindowSize(8);function H(v,L,b,y=k){let A=v;L=rt("msgHash",L),b=rt("publicKey",b);let{lowS:S,prehash:R,format:P}=y;if(Ya(y),"strict"in y)throw new Error("options.strict was renamed to lowS");if(P!==void 0&&P!=="compact"&&P!=="der")throw new Error("format must be compact or der");let D=typeof A=="string"||de(A),q=!D&&!P&&typeof A=="object"&&A!==null&&typeof A.r=="bigint"&&typeof A.s=="bigint";if(!D&&!q)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let M,z;try{if(q&&(M=new h(A.r,A.s)),D){try{P!=="compact"&&(M=h.fromDER(A))}catch(Zt){if(!(Zt instanceof ne.Err))throw Zt}!M&&P!=="der"&&(M=h.fromCompact(A))}z=c.fromHex(b)}catch{return!1}if(!M||S&&M.hasHighS())return!1;R&&(L=t.hash(L));let{r:$,s:nt}=M,ot=C(L),it=a(nt),Et=i(ot*it),Ut=i($*it),_t=c.BASE.multiplyAndAddUnsafe(z,Et,Ut)?.toAffine();return _t?i(_t.x)===$:!1}return{CURVE:t,getPublicKey:E,getSharedSecret:I,sign:K,verify:H,ProjectivePoint:c,Signature:h,utils:x}}function gh(r){return{hash:r,hmac:(t,...e)=>Ye(r,t,go(...e)),randomBytes:dr}}function tc(r,t){let e=n=>Qa({...r,...gh(n)});return{...e(t),create:e}}var nc=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),ec=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),wh=BigInt(1),vs=BigInt(2),rc=(r,t)=>(r+t/vs)/t;function xh(r){let t=nc,e=BigInt(3),n=BigInt(6),o=BigInt(11),s=BigInt(22),i=BigInt(23),a=BigInt(44),c=BigInt(88),f=r*r*r%t,u=f*f*r%t,l=st(u,e,t)*u%t,d=st(l,e,t)*u%t,g=st(d,vs,t)*f%t,w=st(g,o,t)*g%t,m=st(w,s,t)*w%t,h=st(m,a,t)*m%t,x=st(h,c,t)*h%t,E=st(x,a,t)*m%t,p=st(E,e,t)*u%t,I=st(p,i,t)*w%t,U=st(I,n,t)*f%t,C=st(U,vs,t);if(!Bs.eql(Bs.sqr(C),r))throw new Error("Cannot find square root");return C}var Bs=me(nc,void 0,void 0,{sqrt:xh}),Pe=tc({a:BigInt(0),b:BigInt(7),Fp:Bs,n:ec,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:r=>{let t=ec,e=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-wh*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),o=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=e,i=BigInt("0x100000000000000000000000000000000"),a=rc(s*r,t),c=rc(-n*r,t),f=j(r-a*e-c*o,t),u=j(-a*n-c*s,t),l=f>i,d=u>i;if(l&&(f=t-f),d&&(u=t-u),f>i||u>i)throw new Error("splitScalar: Endomorphism failed, k="+r);return{k1neg:l,k1:f,k2neg:d,k2:u}}}},$t),Ty=BigInt(0);var _y=Pe.ProjectivePoint;function oc(r){return r==null?!1:typeof r.then=="function"&&typeof r.catch=="function"&&typeof r.finally=="function"}function sc(r,t,e){let n=br.digest(e instanceof Uint8Array?e:e.subarray());if(oc(n))return n.then(({digest:o})=>Pe.verify(t,o,r)).catch(o=>{throw new vr(String(o))});try{return Pe.verify(t,n.digest,r)}catch(o){throw new vr(String(o))}}var En=class{type="secp256k1";raw;_key;constructor(t){this._key=ac(t),this.raw=ic(this._key)}toMultihash(){return Yt.digest(Ze(this))}toCID(){return lt.createV1(114,this.toMultihash())}toString(){return et.encode(this.toMultihash().bytes).substring(1)}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:wt(this.raw,t.raw)}verify(t,e){return sc(this._key,e,t)}};function Is(r){return new En(r)}function ic(r){return Pe.ProjectivePoint.fromHex(r).toRawBytes(!0)}function ac(r){try{return Pe.ProjectivePoint.fromHex(r),r}catch(t){throw new Oe(String(t))}}function Lr(r,t){let{Type:e,Data:n}=Wt.decode(r),o=n??new Uint8Array;switch(e){case mt.RSA:return Ss(o,t);case mt.Ed25519:return Do(o);case mt.secp256k1:return Is(o);default:throw new be}}function cc(r){let{Type:t,Data:e}=Wt.decode(r.digest),n=e??new Uint8Array;switch(t){case mt.Ed25519:return Do(n);case mt.secp256k1:return Is(n);default:throw new be}}function Ze(r){return Wt.encode({Type:mt[r.type],Data:r.raw})}var uc=Symbol.for("nodejs.util.inspect.custom"),bh=114,Tr=class{type;multihash;publicKey;string;constructor(t){this.type=t.type,this.multihash=t.multihash,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}[oo]=!0;toString(){return this.string==null&&(this.string=et.encode(this.multihash.bytes).slice(1)),this.string}toMultihash(){return this.multihash}toCID(){return lt.createV1(bh,this.multihash)}toJSON(){return this.toString()}equals(t){if(t==null)return!1;if(t instanceof Uint8Array)return wt(this.multihash.bytes,t);if(typeof t=="string")return this.toString()===t;if(t?.toMultihash()?.bytes!=null)return wt(this.multihash.bytes,t.toMultihash().bytes);throw new Error("not valid Id")}[uc](){return`PeerId(${this.toString()})`}},_r=class extends Tr{type="RSA";publicKey;constructor(t){super({...t,type:"RSA"}),this.publicKey=t.publicKey}},Cr=class extends Tr{type="Ed25519";publicKey;constructor(t){super({...t,type:"Ed25519"}),this.publicKey=t.publicKey}},Ur=class extends Tr{type="secp256k1";publicKey;constructor(t){super({...t,type:"secp256k1"}),this.publicKey=t.publicKey}},Eh=2336,Rr=class{type="url";multihash;publicKey;url;constructor(t){this.url=t.toString(),this.multihash=Yt.digest(tt(this.url))}[uc](){return`PeerId(${this.url})`}[oo]=!0;toString(){return this.toCID().toString()}toMultihash(){return this.multihash}toCID(){return lt.createV1(Eh,this.toMultihash())}toJSON(){return this.toString()}equals(t){return t==null?!1:(t instanceof Uint8Array&&(t=F(t)),t.toString()===this.toString())}};var Sh=114,fc=2336;function lc(r,t){let e;if(r.charAt(0)==="1"||r.charAt(0)==="Q")e=ue(et.decode(`z${r}`));else{if(r.startsWith("k51qzi5uqu5")||r.startsWith("kzwfwjn5ji4")||r.startsWith("k2k4r8")||r.startsWith("bafz"))return Ah(lt.parse(r));if(t==null)throw new yt('Please pass a multibase decoder for strings that do not start with "1" or "Q"');e=ue(t.decode(r))}return hc(e)}function Ls(r){if(r.type==="Ed25519")return new Cr({multihash:r.toCID().multihash,publicKey:r});if(r.type==="secp256k1")return new Ur({multihash:r.toCID().multihash,publicKey:r});if(r.type==="RSA")return new _r({multihash:r.toCID().multihash,publicKey:r});throw new be}function hc(r){if(Bh(r))return new _r({multihash:r});if(vh(r))try{let t=cc(r);if(t.type==="Ed25519")return new Cr({multihash:r,publicKey:t});if(t.type==="secp256k1")return new Ur({multihash:r,publicKey:t})}catch{let e=F(r.digest);return new Rr(new URL(e))}throw new Zr("Supplied PeerID Multihash is invalid")}function Ah(r){if(r?.multihash==null||r.version==null||r.version===1&&r.code!==Sh&&r.code!==fc)throw new $r("Supplied PeerID CID is invalid");if(r.code===fc){let t=F(r.multihash.digest);return new Rr(new URL(t))}return hc(r.multihash)}function vh(r){return r.code===Yt.code}function Bh(r){return r.code===br.code}function Sn(r){return r[Symbol.asyncIterator]!=null}var An=r=>{let t=ft(r),e=pt(t);return Gt(r,e),An.bytes=t,e};An.bytes=0;function dc(r,t){t=t??{};let e=t.lengthEncoder??An;function*n(o){let s=e(o.byteLength);s instanceof Uint8Array?yield s:yield*s,o instanceof Uint8Array?yield o:yield*o}return Sn(r)?async function*(){for await(let o of r)yield*n(o)}():function*(){for(let o of r)yield*n(o)}()}dc.single=(r,t)=>{t=t??{};let e=t.lengthEncoder??An;return new Z(e(r.byteLength),r)};var vn=class extends Error{name="InvalidMessageLengthError";code="ERR_INVALID_MSG_LENGTH"},Bn=class extends Error{name="InvalidDataLengthError";code="ERR_MSG_DATA_TOO_LONG"},In=class extends Error{name="InvalidDataLengthLengthError";code="ERR_MSG_LENGTH_TOO_LONG"},Pr=class extends Error{name="UnexpectedEOFError";code="ERR_UNEXPECTED_EOF"};var Ih=8,Lh=1024*1024*4,ke;(function(r){r[r.LENGTH=0]="LENGTH",r[r.DATA=1]="DATA"})(ke||(ke={}));var Ts=r=>{let t=qt(r);return Ts.bytes=ft(t),t};Ts.bytes=0;function kr(r,t){let e=new Z,n=ke.LENGTH,o=-1,s=t?.lengthDecoder??Ts,i=t?.maxLengthLength??Ih,a=t?.maxDataLength??Lh;function*c(){for(;e.byteLength>0;){if(n===ke.LENGTH)try{if(o=s(e),o<0)throw new vn("Invalid message length");if(o>a)throw new Bn("Message length too long");let f=s.bytes;e.consume(f),t?.onLength!=null&&t.onLength(o),n=ke.DATA}catch(f){if(f instanceof RangeError){if(e.byteLength>i)throw new In("Message length length too long");break}throw f}if(n===ke.DATA){if(e.byteLength<o)break;let f=e.sublist(0,o);e.consume(o),t?.onData!=null&&t.onData(f),yield f,n=ke.LENGTH}}}return Sn(r)?async function*(){for await(let f of r)e.append(f),yield*c();if(e.byteLength>0)throw new Pr("Unexpected end of input")}():function*(){for(let f of r)e.append(f),yield*c();if(e.byteLength>0)throw new Pr("Unexpected end of input")}()}kr.fromReader=(r,t)=>{let e=1,n=async function*(){for(;;)try{let{done:s,value:i}=await r.next(e);if(s===!0)return;i!=null&&(yield i)}catch(s){if(s.code==="ERR_UNDER_READ")return{done:!0,value:null};throw s}finally{e=1}}();return kr(n,{...t??{},onLength:s=>{e=s}})};function It(){let r={};return r.promise=new Promise((t,e)=>{r.resolve=t,r.reject=e}),r}var Ln=class extends Error{type;code;constructor(t,e,n){super(t??"The operation was aborted"),this.type="aborted",this.name=n??"AbortError",this.code=e??"ABORT_ERR"}};async function Ct(r,t,e){if(t==null)return r;if(t.aborted)return r.catch(()=>{}),Promise.reject(new Ln(e?.errorMessage,e?.errorCode,e?.errorName));let n,o=new Ln(e?.errorMessage,e?.errorCode,e?.errorName);try{return await Promise.race([r,new Promise((s,i)=>{n=()=>{i(o)},t.addEventListener("abort",n)})])}finally{n!=null&&t.removeEventListener("abort",n)}}var _s=class{readNext;haveNext;ended;nextResult;constructor(){this.ended=!1,this.readNext=It(),this.haveNext=It()}[Symbol.asyncIterator](){return this}async next(){if(this.nextResult==null&&await this.haveNext.promise,this.nextResult==null)throw new Error("HaveNext promise resolved but nextResult was undefined");let t=this.nextResult;return this.nextResult=void 0,this.readNext.resolve(),this.readNext=It(),t}async throw(t){return this.ended=!0,t!=null&&(this.haveNext.promise.catch(()=>{}),this.haveNext.reject(t)),{done:!0,value:void 0}}async return(){let t={done:!0,value:void 0};return this.ended=!0,this.nextResult=t,this.haveNext.resolve(),t}async push(t,e){await this._push(t,e)}async end(t,e){t!=null?await this.throw(t):await this._push(void 0,e)}async _push(t,e){if(t!=null&&this.ended)throw new Error("Cannot push value onto an ended pushable");for(;this.nextResult!=null;)await this.readNext.promise;t!=null?this.nextResult={done:!1,value:t}:(this.ended=!0,this.nextResult={done:!0,value:void 0}),this.haveNext.resolve(),this.haveNext=It(),await Ct(this.readNext.promise,e?.signal,e)}};function pc(){return new _s}var Tn=class extends Error{name="UnexpectedEOFError";code="ERR_UNEXPECTED_EOF"};var Cs=class extends Error{code;constructor(t,e){super(t),this.code=e}},Us=class extends Cs{type;constructor(t){super(t,"ABORT_ERR"),this.type="aborted",this.name="AbortError"}};function mc(r,t){let e=pc();r.sink(e).catch(async i=>{await e.end(i)}),r.sink=async i=>{for await(let a of i)await e.push(a);await e.end()};let n=r.source;r.source[Symbol.iterator]!=null?n=r.source[Symbol.iterator]():r.source[Symbol.asyncIterator]!=null&&(n=r.source[Symbol.asyncIterator]());let o=new Z;return{read:async(i,a)=>{a?.signal?.throwIfAborted();let c,f=new Promise((u,l)=>{c=()=>{l(new Us("Read aborted"))},a?.signal?.addEventListener("abort",c)});try{if(i==null){let{done:l,value:d}=await Promise.race([n.next(),f]);return l===!0?new Z:d}for(;o.byteLength<i;){let{value:l,done:d}=await Promise.race([n.next(),f]);if(d===!0)throw new Tn("unexpected end of input");o.append(l)}let u=o.sublist(0,i);return o.consume(i),u}finally{c!=null&&a?.signal?.removeEventListener("abort",c)}},write:async(i,a)=>{a?.signal?.throwIfAborted(),i instanceof Uint8Array?await e.push(i,a):await e.push(i.subarray(),a)},unwrap:()=>{if(o.byteLength>0){let i=r.source;r.source=async function*(){t?.yieldBytes===!1?yield o:yield*o,yield*i}()}return r}}}var _n=class extends Error{name="InvalidMessageLengthError";code="ERR_INVALID_MSG_LENGTH"},Cn=class extends Error{name="InvalidDataLengthError";code="ERR_MSG_DATA_TOO_LONG"},Un=class extends Error{name="InvalidDataLengthLengthError";code="ERR_MSG_LENGTH_TOO_LONG"};function Rs(r,t={}){let e=mc(r,t);t.maxDataLength!=null&&t.maxLengthLength==null&&(t.maxLengthLength=ft(t.maxDataLength));let n=t?.lengthDecoder??qt,o=t?.lengthEncoder??Gt;return{read:async i=>{let a=-1,c=new Z;for(;;){c.append(await e.read(1,i));try{a=n(c)}catch(f){if(f instanceof RangeError)continue;throw f}if(a<0)throw new _n("Invalid message length");if(t?.maxLengthLength!=null&&c.byteLength>t.maxLengthLength)throw new Un("message length length too long");if(a>-1)break}if(t?.maxDataLength!=null&&a>t.maxDataLength)throw new Cn("message length too long");return e.read(a,i)},write:async(i,a)=>{await e.write(new Z(o(i.byteLength),i),a)},writeV:async(i,a)=>{let c=new Z(...i.flatMap(f=>[o(f.byteLength),f]));await e.write(c,a)},unwrap:()=>e.unwrap()}}function Ps(){let r=It(),t=!1;return{sink:async e=>{if(t)throw new Error("already piped");t=!0,r.resolve(e)},source:async function*(){yield*await r.promise}()}}function yc(){let r=Ps(),t=Ps();return[{source:r.source,sink:t.sink},{source:t.source,sink:r.sink}]}var Rn=class{buffer;mask;top;btm;next;constructor(t){if(!(t>0)||(t-1&t)!==0)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(t),this.mask=t-1,this.top=0,this.btm=0,this.next=null}push(t){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=t,this.top=this.top+1&this.mask,!0)}shift(){let t=this.buffer[this.btm];if(t!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,t}isEmpty(){return this.buffer[this.btm]===void 0}},Je=class{size;hwm;head;tail;constructor(t={}){this.hwm=t.splitLimit??16,this.head=new Rn(this.hwm),this.tail=this.head,this.size=0}calculateSize(t){return t?.byteLength!=null?t.byteLength:1}push(t){if(t?.value!=null&&(this.size+=this.calculateSize(t.value)),!this.head.push(t)){let e=this.head;this.head=e.next=new Rn(2*this.head.buffer.length),this.head.push(t)}}shift(){let t=this.tail.shift();if(t===void 0&&this.tail.next!=null){let e=this.tail.next;this.tail.next=null,this.tail=e,t=this.tail.shift()}return t?.value!=null&&(this.size-=this.calculateSize(t.value)),t}isEmpty(){return this.head.isEmpty()}};var ks=class extends Error{type;code;constructor(t,e){super(t??"The operation was aborted"),this.type="aborted",this.code=e??"ABORT_ERR"}};function Qe(r={}){return Th(e=>{let n=e.shift();if(n==null)return{done:!0};if(n.error!=null)throw n.error;return{done:n.done===!0,value:n.value}},r)}function Th(r,t){t=t??{};let e=t.onEnd,n=new Je,o,s,i,a=It(),c=async()=>{try{return n.isEmpty()?i?{done:!0}:await new Promise((h,x)=>{s=E=>{s=null,n.push(E);try{h(r(n))}catch(p){x(p)}return o}}):r(n)}finally{n.isEmpty()&&queueMicrotask(()=>{a.resolve(),a=It()})}},f=h=>s!=null?s(h):(n.push(h),o),u=h=>(n=new Je,s!=null?s({error:h}):(n.push({error:h}),o)),l=h=>{if(i)return o;if(t?.objectMode!==!0&&h?.byteLength==null)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return f({done:!1,value:h})},d=h=>i?o:(i=!0,h!=null?u(h):f({done:!0})),g=()=>(n=new Je,d(),{done:!0}),w=h=>(d(h),{done:!0});if(o={[Symbol.asyncIterator](){return this},next:c,return:g,throw:w,push:l,end:d,get readableLength(){return n.size},onEmpty:async h=>{let x=h?.signal;if(x?.throwIfAborted(),n.isEmpty())return;let E,p;x!=null&&(E=new Promise((I,U)=>{p=()=>{U(new ks)},x.addEventListener("abort",p)}));try{await Promise.race([a.promise,E])}finally{p!=null&&x!=null&&x?.removeEventListener("abort",p)}}},e==null)return o;let m=o;return o={[Symbol.asyncIterator](){return this},next(){return m.next()},throw(h){return m.throw(h),e!=null&&(e(h),e=void 0),{done:!0}},return(){return m.return(),e!=null&&(e(),e=void 0),{done:!0}},push:l,end(h){return m.end(h),e!=null&&(e(h),e=void 0),o},get readableLength(){return m.readableLength},onEmpty:h=>m.onEmpty(h)},o}function _h(r){return r[Symbol.asyncIterator]!=null}async function Ch(r,t){try{await Promise.all(r.map(async e=>{for await(let n of e)t.push(n)})),t.end()}catch(e){t.end(e)}}async function*Uh(r){let t=Qe({objectMode:!0});Ch(r,t).catch(()=>{}),yield*t}function*Rh(r){for(let t of r)yield*t}function Ph(...r){let t=[];for(let e of r)_h(e)||t.push(e);return t.length===r.length?Rh(t):Uh(r)}var gc=Ph;function wc(r,...t){if(r==null)throw new Error("Empty pipeline");if(Ns(r)){let n=r;r=()=>n.source}else if(bc(r)||xc(r)){let n=r;r=()=>n}let e=[r,...t];if(e.length>1&&Ns(e[e.length-1])&&(e[e.length-1]=e[e.length-1].sink),e.length>2)for(let n=1;n<e.length-1;n++)Ns(e[n])&&(e[n]=Nh(e[n]));return kh(...e)}var kh=(...r)=>{let t;for(;r.length>0;)t=r.shift()(t);return t},xc=r=>r?.[Symbol.asyncIterator]!=null,bc=r=>r?.[Symbol.iterator]!=null,Ns=r=>r==null?!1:r.sink!=null&&r.source!=null,Nh=r=>t=>{let e=r.sink(t);if(e?.then!=null){let n=Qe({objectMode:!0});e.then(()=>{n.end()},i=>{n.end(i)});let o,s=r.source;if(xc(s))o=async function*(){yield*s,n.end()};else if(bc(s))o=function*(){yield*s,n.end()};else throw new Error("Unknown duplex source type - must be Iterable or AsyncIterable");return gc(n,o())}return r.source};var tr=!!globalThis.process?.env?.DUMP_SESSION_KEYS;function Pn(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function Ds(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function Lt(r,...t){if(!Ds(r))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(r.length))throw new Error("Uint8Array expected of length "+t+", got length="+r.length)}function Ks(r,t=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(t&&r.finished)throw new Error("Hash#digest() has already been called")}function Ec(r,t){Lt(r);let e=t.outputLen;if(r.length<e)throw new Error("digestInto() expects output buffer of length at least "+e)}function Os(r){if(typeof r!="boolean")throw new Error(`boolean expected, not ${r}`)}var se=r=>new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4)),Sc=r=>new DataView(r.buffer,r.byteOffset,r.byteLength),Dh=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!Dh)throw new Error("Non little-endian hardware is not supported");function Kh(r){if(typeof r!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(r))}function kn(r){if(typeof r=="string")r=Kh(r);else if(Ds(r))r=Nn(r);else throw new Error("Uint8Array expected, got "+typeof r);return r}function Ac(r,t){if(t==null||typeof t!="object")throw new Error("options must be defined");return Object.assign(r,t)}function vc(r,t){if(r.length!==t.length)return!1;let e=0;for(let n=0;n<r.length;n++)e|=r[n]^t[n];return e===0}var Ms=(r,t)=>{function e(n,...o){if(Lt(n),r.nonceLength!==void 0){let u=o[0];if(!u)throw new Error("nonce / iv required");r.varSizeNonce?Lt(u):Lt(u,r.nonceLength)}let s=r.tagLength;s&&o[1]!==void 0&&Lt(o[1]);let i=t(n,...o),a=(u,l)=>{if(l!==void 0){if(u!==2)throw new Error("cipher output not supported");Lt(l)}},c=!1;return{encrypt(u,l){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,Lt(u),a(i.encrypt.length,l),i.encrypt(u,l)},decrypt(u,l){if(Lt(u),s&&u.length<s)throw new Error("invalid ciphertext length: smaller than tagLength="+s);return a(i.decrypt.length,l),i.decrypt(u,l)}}}return Object.assign(e,r),e};function Hs(r,t,e=!0){if(t===void 0)return new Uint8Array(r);if(t.length!==r)throw new Error("invalid output length, expected "+r+", got: "+t.length);if(e&&!Oh(t))throw new Error("invalid output, must be aligned");return t}function qs(r,t,e,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(t,e,n);let o=BigInt(32),s=BigInt(4294967295),i=Number(e>>o&s),a=Number(e&s),c=n?4:0,f=n?0:4;r.setUint32(t+c,i,n),r.setUint32(t+f,a,n)}function Oh(r){return r.byteOffset%4===0}function Nn(r){return Uint8Array.from(r)}function ie(...r){for(let t=0;t<r.length;t++)r[t].fill(0)}var Ic=r=>Uint8Array.from(r.split("").map(t=>t.charCodeAt(0))),Mh=Ic("expand 16-byte k"),Hh=Ic("expand 32-byte k"),qh=se(Mh),Vh=se(Hh);function N(r,t){return r<<t|r>>>32-t}function Vs(r){return r.byteOffset%4===0}var Dn=64,Fh=16,Lc=2**32-1,Bc=new Uint32Array;function zh(r,t,e,n,o,s,i,a){let c=o.length,f=new Uint8Array(Dn),u=se(f),l=Vs(o)&&Vs(s),d=l?se(o):Bc,g=l?se(s):Bc;for(let w=0;w<c;i++){if(r(t,e,n,u,i,a),i>=Lc)throw new Error("arx: counter overflow");let m=Math.min(Dn,c-w);if(l&&m===Dn){let h=w/4;if(w%4!==0)throw new Error("arx: invalid block position");for(let x=0,E;x<Fh;x++)E=h+x,g[E]=d[E]^u[x];w+=Dn;continue}for(let h=0,x;h<m;h++)x=w+h,s[x]=o[x]^f[h];w+=m}}function Fs(r,t){let{allowShortKeys:e,extendNonceFn:n,counterLength:o,counterRight:s,rounds:i}=Ac({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},t);if(typeof r!="function")throw new Error("core must be a function");return Pn(o),Pn(i),Os(s),Os(e),(a,c,f,u,l=0)=>{Lt(a),Lt(c),Lt(f);let d=f.length;if(u===void 0&&(u=new Uint8Array(d)),Lt(u),Pn(l),l<0||l>=Lc)throw new Error("arx: counter overflow");if(u.length<d)throw new Error(`arx: output (${u.length}) is shorter than data (${d})`);let g=[],w=a.length,m,h;if(w===32)g.push(m=Nn(a)),h=Vh;else if(w===16&&e)m=new Uint8Array(32),m.set(a),m.set(a,16),h=qh,g.push(m);else throw new Error(`arx: invalid 32-byte key, got length=${w}`);Vs(c)||g.push(c=Nn(c));let x=se(m);if(n){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");n(h,x,se(c.subarray(0,16)),x),c=c.subarray(16)}let E=16-o;if(E!==c.length)throw new Error(`arx: nonce must be ${E} or 16 bytes`);if(E!==12){let I=new Uint8Array(12);I.set(c,s?0:12-c.length),c=I,g.push(c)}let p=se(c);return zh(r,h,x,p,f,u,l,i),ie(...g),u}}var bt=(r,t)=>r[t++]&255|(r[t++]&255)<<8,zs=class{constructor(t){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,t=kn(t),Lt(t,32);let e=bt(t,0),n=bt(t,2),o=bt(t,4),s=bt(t,6),i=bt(t,8),a=bt(t,10),c=bt(t,12),f=bt(t,14);this.r[0]=e&8191,this.r[1]=(e>>>13|n<<3)&8191,this.r[2]=(n>>>10|o<<6)&7939,this.r[3]=(o>>>7|s<<9)&8191,this.r[4]=(s>>>4|i<<12)&255,this.r[5]=i>>>1&8190,this.r[6]=(i>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|f<<8)&8191,this.r[9]=f>>>5&127;for(let u=0;u<8;u++)this.pad[u]=bt(t,16+2*u)}process(t,e,n=!1){let o=n?0:2048,{h:s,r:i}=this,a=i[0],c=i[1],f=i[2],u=i[3],l=i[4],d=i[5],g=i[6],w=i[7],m=i[8],h=i[9],x=bt(t,e+0),E=bt(t,e+2),p=bt(t,e+4),I=bt(t,e+6),U=bt(t,e+8),C=bt(t,e+10),T=bt(t,e+12),_=bt(t,e+14),B=s[0]+(x&8191),O=s[1]+((x>>>13|E<<3)&8191),k=s[2]+((E>>>10|p<<6)&8191),K=s[3]+((p>>>7|I<<9)&8191),H=s[4]+((I>>>4|U<<12)&8191),v=s[5]+(U>>>1&8191),L=s[6]+((U>>>14|C<<2)&8191),b=s[7]+((C>>>11|T<<5)&8191),y=s[8]+((T>>>8|_<<8)&8191),A=s[9]+(_>>>5|o),S=0,R=S+B*a+O*(5*h)+k*(5*m)+K*(5*w)+H*(5*g);S=R>>>13,R&=8191,R+=v*(5*d)+L*(5*l)+b*(5*u)+y*(5*f)+A*(5*c),S+=R>>>13,R&=8191;let P=S+B*c+O*a+k*(5*h)+K*(5*m)+H*(5*w);S=P>>>13,P&=8191,P+=v*(5*g)+L*(5*d)+b*(5*l)+y*(5*u)+A*(5*f),S+=P>>>13,P&=8191;let D=S+B*f+O*c+k*a+K*(5*h)+H*(5*m);S=D>>>13,D&=8191,D+=v*(5*w)+L*(5*g)+b*(5*d)+y*(5*l)+A*(5*u),S+=D>>>13,D&=8191;let q=S+B*u+O*f+k*c+K*a+H*(5*h);S=q>>>13,q&=8191,q+=v*(5*m)+L*(5*w)+b*(5*g)+y*(5*d)+A*(5*l),S+=q>>>13,q&=8191;let M=S+B*l+O*u+k*f+K*c+H*a;S=M>>>13,M&=8191,M+=v*(5*h)+L*(5*m)+b*(5*w)+y*(5*g)+A*(5*d),S+=M>>>13,M&=8191;let z=S+B*d+O*l+k*u+K*f+H*c;S=z>>>13,z&=8191,z+=v*a+L*(5*h)+b*(5*m)+y*(5*w)+A*(5*g),S+=z>>>13,z&=8191;let $=S+B*g+O*d+k*l+K*u+H*f;S=$>>>13,$&=8191,$+=v*c+L*a+b*(5*h)+y*(5*m)+A*(5*w),S+=$>>>13,$&=8191;let nt=S+B*w+O*g+k*d+K*l+H*u;S=nt>>>13,nt&=8191,nt+=v*f+L*c+b*a+y*(5*h)+A*(5*m),S+=nt>>>13,nt&=8191;let ot=S+B*m+O*w+k*g+K*d+H*l;S=ot>>>13,ot&=8191,ot+=v*u+L*f+b*c+y*a+A*(5*h),S+=ot>>>13,ot&=8191;let it=S+B*h+O*m+k*w+K*g+H*d;S=it>>>13,it&=8191,it+=v*l+L*u+b*f+y*c+A*a,S+=it>>>13,it&=8191,S=(S<<2)+S|0,S=S+R|0,R=S&8191,S=S>>>13,P+=S,s[0]=R,s[1]=P,s[2]=D,s[3]=q,s[4]=M,s[5]=z,s[6]=$,s[7]=nt,s[8]=ot,s[9]=it}finalize(){let{h:t,pad:e}=this,n=new Uint16Array(10),o=t[1]>>>13;t[1]&=8191;for(let a=2;a<10;a++)t[a]+=o,o=t[a]>>>13,t[a]&=8191;t[0]+=o*5,o=t[0]>>>13,t[0]&=8191,t[1]+=o,o=t[1]>>>13,t[1]&=8191,t[2]+=o,n[0]=t[0]+5,o=n[0]>>>13,n[0]&=8191;for(let a=1;a<10;a++)n[a]=t[a]+o,o=n[a]>>>13,n[a]&=8191;n[9]-=8192;let s=(o^1)-1;for(let a=0;a<10;a++)n[a]&=s;s=~s;for(let a=0;a<10;a++)t[a]=t[a]&s|n[a];t[0]=(t[0]|t[1]<<13)&65535,t[1]=(t[1]>>>3|t[2]<<10)&65535,t[2]=(t[2]>>>6|t[3]<<7)&65535,t[3]=(t[3]>>>9|t[4]<<4)&65535,t[4]=(t[4]>>>12|t[5]<<1|t[6]<<14)&65535,t[5]=(t[6]>>>2|t[7]<<11)&65535,t[6]=(t[7]>>>5|t[8]<<8)&65535,t[7]=(t[8]>>>8|t[9]<<5)&65535;let i=t[0]+e[0];t[0]=i&65535;for(let a=1;a<8;a++)i=(t[a]+e[a]|0)+(i>>>16)|0,t[a]=i&65535;ie(n)}update(t){Ks(this);let{buffer:e,blockLen:n}=this;t=kn(t);let o=t.length;for(let s=0;s<o;){let i=Math.min(n-this.pos,o-s);if(i===n){for(;n<=o-s;s+=n)this.process(t,s);continue}e.set(t.subarray(s,s+i),this.pos),this.pos+=i,s+=i,this.pos===n&&(this.process(e,0,!1),this.pos=0)}return this}destroy(){ie(this.h,this.r,this.buffer,this.pad)}digestInto(t){Ks(this),Ec(t,this),this.finished=!0;let{buffer:e,h:n}=this,{pos:o}=this;if(o){for(e[o++]=1;o<16;o++)e[o]=0;this.process(e,0,!0)}this.finalize();let s=0;for(let i=0;i<8;i++)t[s++]=n[i]>>>0,t[s++]=n[i]>>>8;return t}digest(){let{buffer:t,outputLen:e}=this;this.digestInto(t);let n=t.slice(0,e);return this.destroy(),n}};function Gh(r){let t=(n,o)=>r(o).update(kn(n)).digest(),e=r(new Uint8Array(32));return t.outputLen=e.outputLen,t.blockLen=e.blockLen,t.create=n=>r(n),t}var Tc=Gh(r=>new zs(r));function Uc(r,t,e,n,o,s=20){let i=r[0],a=r[1],c=r[2],f=r[3],u=t[0],l=t[1],d=t[2],g=t[3],w=t[4],m=t[5],h=t[6],x=t[7],E=o,p=e[0],I=e[1],U=e[2],C=i,T=a,_=c,B=f,O=u,k=l,K=d,H=g,v=w,L=m,b=h,y=x,A=E,S=p,R=I,P=U;for(let q=0;q<s;q+=2)C=C+O|0,A=N(A^C,16),v=v+A|0,O=N(O^v,12),C=C+O|0,A=N(A^C,8),v=v+A|0,O=N(O^v,7),T=T+k|0,S=N(S^T,16),L=L+S|0,k=N(k^L,12),T=T+k|0,S=N(S^T,8),L=L+S|0,k=N(k^L,7),_=_+K|0,R=N(R^_,16),b=b+R|0,K=N(K^b,12),_=_+K|0,R=N(R^_,8),b=b+R|0,K=N(K^b,7),B=B+H|0,P=N(P^B,16),y=y+P|0,H=N(H^y,12),B=B+H|0,P=N(P^B,8),y=y+P|0,H=N(H^y,7),C=C+k|0,P=N(P^C,16),b=b+P|0,k=N(k^b,12),C=C+k|0,P=N(P^C,8),b=b+P|0,k=N(k^b,7),T=T+K|0,A=N(A^T,16),y=y+A|0,K=N(K^y,12),T=T+K|0,A=N(A^T,8),y=y+A|0,K=N(K^y,7),_=_+H|0,S=N(S^_,16),v=v+S|0,H=N(H^v,12),_=_+H|0,S=N(S^_,8),v=v+S|0,H=N(H^v,7),B=B+O|0,R=N(R^B,16),L=L+R|0,O=N(O^L,12),B=B+O|0,R=N(R^B,8),L=L+R|0,O=N(O^L,7);let D=0;n[D++]=i+C|0,n[D++]=a+T|0,n[D++]=c+_|0,n[D++]=f+B|0,n[D++]=u+O|0,n[D++]=l+k|0,n[D++]=d+K|0,n[D++]=g+H|0,n[D++]=w+v|0,n[D++]=m+L|0,n[D++]=h+b|0,n[D++]=x+y|0,n[D++]=E+A|0,n[D++]=p+S|0,n[D++]=I+R|0,n[D++]=U+P|0}function Wh(r,t,e,n){let o=r[0],s=r[1],i=r[2],a=r[3],c=t[0],f=t[1],u=t[2],l=t[3],d=t[4],g=t[5],w=t[6],m=t[7],h=e[0],x=e[1],E=e[2],p=e[3];for(let U=0;U<20;U+=2)o=o+c|0,h=N(h^o,16),d=d+h|0,c=N(c^d,12),o=o+c|0,h=N(h^o,8),d=d+h|0,c=N(c^d,7),s=s+f|0,x=N(x^s,16),g=g+x|0,f=N(f^g,12),s=s+f|0,x=N(x^s,8),g=g+x|0,f=N(f^g,7),i=i+u|0,E=N(E^i,16),w=w+E|0,u=N(u^w,12),i=i+u|0,E=N(E^i,8),w=w+E|0,u=N(u^w,7),a=a+l|0,p=N(p^a,16),m=m+p|0,l=N(l^m,12),a=a+l|0,p=N(p^a,8),m=m+p|0,l=N(l^m,7),o=o+f|0,p=N(p^o,16),w=w+p|0,f=N(f^w,12),o=o+f|0,p=N(p^o,8),w=w+p|0,f=N(f^w,7),s=s+u|0,h=N(h^s,16),m=m+h|0,u=N(u^m,12),s=s+u|0,h=N(h^s,8),m=m+h|0,u=N(u^m,7),i=i+l|0,x=N(x^i,16),d=d+x|0,l=N(l^d,12),i=i+l|0,x=N(x^i,8),d=d+x|0,l=N(l^d,7),a=a+c|0,E=N(E^a,16),g=g+E|0,c=N(c^g,12),a=a+c|0,E=N(E^a,8),g=g+E|0,c=N(c^g,7);let I=0;n[I++]=o,n[I++]=s,n[I++]=i,n[I++]=a,n[I++]=h,n[I++]=x,n[I++]=E,n[I++]=p}var $h=Fs(Uc,{counterRight:!1,counterLength:4,allowShortKeys:!1}),Zh=Fs(Uc,{counterRight:!1,counterLength:8,extendNonceFn:Wh,allowShortKeys:!1});var jh=new Uint8Array(16),_c=(r,t)=>{r.update(t);let e=t.length%16;e&&r.update(jh.subarray(e))},Xh=new Uint8Array(32);function Cc(r,t,e,n,o){let s=r(t,e,Xh),i=Tc.create(s);o&&_c(i,o),_c(i,n);let a=new Uint8Array(16),c=Sc(a);qs(c,0,BigInt(o?o.length:0),!0),qs(c,8,BigInt(n.length),!0),i.update(a);let f=i.digest();return ie(s,a),f}var Rc=r=>(t,e,n)=>({encrypt(s,i){let a=s.length;i=Hs(a+16,i,!1),i.set(s);let c=i.subarray(0,-16);r(t,e,c,c,1);let f=Cc(r,t,e,c,n);return i.set(f,a),ie(f),i},decrypt(s,i){i=Hs(s.length-16,i,!1);let a=s.subarray(0,-16),c=s.subarray(-16),f=Cc(r,t,e,a,n);if(!vc(c,f))throw new Error("invalid tag");return i.set(s.subarray(0,-16)),r(t,e,i,i,1),ie(f),i}}),Gs=Ms({blockSize:64,nonceLength:12,tagLength:16},Rc($h)),Uw=Ms({blockSize:64,nonceLength:24,tagLength:16},Rc(Zh));function kc(r,t,e){return hr(r),e===void 0&&(e=new Uint8Array(r.outputLen)),Ye(r,fe(e),fe(t))}var Ws=new Uint8Array([0]),Pc=new Uint8Array;function Nc(r,t,e,n=32){if(hr(r),Yr(n),n>255*r.outputLen)throw new Error("Length should be <= 255*HashLen");let o=Math.ceil(n/r.outputLen);e===void 0&&(e=Pc);let s=new Uint8Array(o*r.outputLen),i=Ye.create(r,t),a=i._cloneInto(),c=new Uint8Array(i.outputLen);for(let f=0;f<o;f++)Ws[0]=f+1,a.update(f===0?Pc:c).update(e).update(Ws).digestInto(c),s.set(c,r.outputLen*f),i._cloneInto(a);return i.destroy(),a.destroy(),c.fill(0),Ws.fill(0),s.slice(0,n)}var $s={hashSHA256(r){return $t(r.subarray())},getHKDF(r,t){let e=kc($t,t,r),o=Nc($t,e,void 0,96),s=o.subarray(0,32),i=o.subarray(32,64),a=o.subarray(64,96);return[s,i,a]},generateX25519KeyPair(){let r=wr.utils.randomPrivateKey();return{publicKey:wr.getPublicKey(r),privateKey:r}},generateX25519KeyPairFromSeed(r){return{publicKey:wr.getPublicKey(r),privateKey:r}},generateX25519SharedKey(r,t){return wr.getSharedSecret(r.subarray(),t.subarray())},chaCha20Poly1305Encrypt(r,t,e,n){return Gs(n,t,e).encrypt(r.subarray())},chaCha20Poly1305Decrypt(r,t,e,n,o){return Gs(n,t,e).decrypt(r.subarray(),o)}};var Dc=$s;function Kc(r){return{generateKeypair:r.generateX25519KeyPair,dh:(t,e)=>r.generateX25519SharedKey(t.privateKey,e).subarray(0,32),encrypt:r.chaCha20Poly1305Encrypt,decrypt:r.chaCha20Poly1305Decrypt,hash:r.hashSHA256,hkdf:r.getHKDF}}var er=r=>{let t=pt(2);return t[0]=r>>8,t[1]=r,t};er.bytes=2;var Nr=r=>{if(r.length<2)throw RangeError("Could not decode int16BE");if(r instanceof Uint8Array){let t=0;return t+=r[0]<<8,t+=r[1],t}return r.getUint16(0)};Nr.bytes=2;function Oc(r){return{xxHandshakeSuccesses:r.registerCounter("libp2p_noise_xxhandshake_successes_total",{help:"Total count of noise xxHandshakes successes_"}),xxHandshakeErrors:r.registerCounter("libp2p_noise_xxhandshake_error_total",{help:"Total count of noise xxHandshakes errors"}),encryptedPackets:r.registerCounter("libp2p_noise_encrypted_packets_total",{help:"Total count of noise encrypted packets successfully"}),decryptedPackets:r.registerCounter("libp2p_noise_decrypted_packets_total",{help:"Total count of noise decrypted packets"}),decryptErrors:r.registerCounter("libp2p_noise_decrypt_errors_total",{help:"Total count of noise decrypt errors"})}}function Zs(r,t){!t.enabled||!tr||(r?(t(`LOCAL_STATIC_PUBLIC_KEY ${F(r.publicKey,"hex")}`),t(`LOCAL_STATIC_PRIVATE_KEY ${F(r.privateKey,"hex")}`)):t("Missing local static keys."))}function js(r,t){!t.enabled||!tr||(r?(t(`LOCAL_PUBLIC_EPHEMERAL_KEY ${F(r.publicKey,"hex")}`),t(`LOCAL_PRIVATE_EPHEMERAL_KEY ${F(r.privateKey,"hex")}`)):t("Missing local ephemeral keys."))}function Mc(r,t){!t.enabled||!tr||t(r?`REMOTE_STATIC_PUBLIC_KEY ${F(r.subarray(),"hex")}`:"Missing remote static public key.")}function Xs(r,t){!t.enabled||!tr||t(r?`REMOTE_EPHEMERAL_PUBLIC_KEY ${F(r.subarray(),"hex")}`:"Missing remote ephemeral keys.")}function Ys(r,t,e){!e.enabled||!tr||(e(`CIPHER_STATE_1 ${r.n.getUint64()} ${r.k&&F(r.k,"hex")}`),e(`CIPHER_STATE_2 ${t.n.getUint64()} ${t.k&&F(t.k,"hex")}`))}var rr=class r extends Error{code;constructor(t="Invalid crypto exchange"){super(t),this.code=r.code}static code="ERR_INVALID_CRYPTO_EXCHANGE"};var Yh=0,Jh=4294967295,Qh="Cipherstate has reached maximum n, a new handshake must be performed",Kn=class{n;bytes;view;constructor(t=Yh){this.n=t,this.bytes=dt(12),this.view=new DataView(this.bytes.buffer,this.bytes.byteOffset,this.bytes.byteLength),this.view.setUint32(4,t,!0)}increment(){this.n++,this.view.setUint32(4,this.n,!0)}getBytes(){return this.bytes}getUint64(){return this.n}assertValue(){if(this.n>Jh)throw new Error(Qh)}};var Ne=dt(0),nr=class{k;n;crypto;constructor(t,e=void 0,n=0){this.crypto=t,this.k=e,this.n=new Kn(n)}hasKey(){return!!this.k}encryptWithAd(t,e){if(!this.hasKey())return e;this.n.assertValue();let n=this.crypto.encrypt(e,this.n.getBytes(),t,this.k);return this.n.increment(),n}decryptWithAd(t,e,n){if(!this.hasKey())return e;this.n.assertValue();let o=this.crypto.decrypt(e,this.n.getBytes(),t,this.k,n);return this.n.increment(),o}},Js=class{cs;ck;h;crypto;constructor(t,e){this.crypto=t;let n=tt(e,"utf-8");this.h=td(t,n),this.ck=this.h,this.cs=new nr(t)}mixKey(t){let[e,n]=this.crypto.hkdf(this.ck,t);this.ck=e,this.cs=new nr(this.crypto,n)}mixHash(t){this.h=this.crypto.hash(new Z(this.h,t))}encryptAndHash(t){let e=this.cs.encryptWithAd(this.h,t);return this.mixHash(e),e}decryptAndHash(t){let e=this.cs.decryptWithAd(this.h,t);return this.mixHash(t),e}split(){let[t,e]=this.crypto.hkdf(this.ck,Ne);return[new nr(this.crypto,t),new nr(this.crypto,e)]}},Qs=class{ss;s;e;rs;re;initiator;crypto;constructor(t){let{crypto:e,protocolName:n,prologue:o,initiator:s,s:i,e:a,rs:c,re:f}=t;this.crypto=e,this.ss=new Js(e,n),this.ss.mixHash(o),this.initiator=s,this.s=i,this.e=a,this.rs=c,this.re=f}writeE(){if(this.e)throw new Error("ephemeral keypair is already set");let t=this.crypto.generateKeypair();return this.ss.mixHash(t.publicKey),this.e=t,t.publicKey}writeS(){if(!this.s)throw new Error("static keypair is not set");return this.ss.encryptAndHash(this.s.publicKey)}writeEE(){if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.re))}writeES(){if(this.initiator){if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.rs)throw new Error("remote static public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.rs))}else{if(!this.s)throw new Error("static keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.s,this.re))}}writeSE(){if(this.initiator){if(!this.s)throw new Error("static keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.s,this.re))}else{if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.rs)throw new Error("remote static public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.rs))}}readE(t,e=0){if(this.re)throw new Error("remote ephemeral public key is already set");if(t.byteLength<e+32)throw new Error("message is not long enough");this.re=t.sublist(e,e+32),this.ss.mixHash(this.re)}readS(t,e=0){if(this.rs)throw new Error("remote static public key is already set");let n=32+(this.ss.cs.hasKey()?16:0);if(t.byteLength<e+n)throw new Error("message is not long enough");let o=t.sublist(e,e+n);return this.rs=this.ss.decryptAndHash(o),n}readEE(){this.writeEE()}readES(){this.writeES()}readSE(){this.writeSE()}},Dr=class extends Qs{writeMessageA(t){return new Z(this.writeE(),this.ss.encryptAndHash(t))}writeMessageB(t){let e=this.writeE();this.writeEE();let n=this.writeS();return this.writeES(),new Z(e,n,this.ss.encryptAndHash(t))}writeMessageC(t){let e=this.writeS();return this.writeSE(),new Z(e,this.ss.encryptAndHash(t))}readMessageA(t){try{return this.readE(t),this.ss.decryptAndHash(t.sublist(32))}catch(e){throw new rr(`handshake stage 0 validation fail: ${e.message}`)}}readMessageB(t){try{this.readE(t),this.readEE();let e=this.readS(t,32);return this.readES(),this.ss.decryptAndHash(t.sublist(32+e))}catch(e){throw new rr(`handshake stage 1 validation fail: ${e.message}`)}}readMessageC(t){try{let e=this.readS(t);return this.readSE(),this.ss.decryptAndHash(t.sublist(e))}catch(e){throw new rr(`handshake stage 2 validation fail: ${e.message}`)}}};function td(r,t){if(t.length<=32){let e=dt(32);return e.set(t),e}else return r.hash(t)}var On;(function(r){let t;r.codec=()=>(t==null&&(t=Re((e,n,o={})=>{if(o.lengthDelimited!==!1&&n.fork(),e.webtransportCerthashes!=null)for(let s of e.webtransportCerthashes)n.uint32(10),n.bytes(s);o.lengthDelimited!==!1&&n.ldelim()},(e,n)=>{let o={webtransportCerthashes:[]},s=n==null?e.len:e.pos+n;for(;e.pos<s;){let i=e.uint32();switch(i>>>3){case 1:{o.webtransportCerthashes.push(e.bytes());break}default:{e.skipType(i&7);break}}}return o})),t),r.encode=e=>Ue(e,r.codec()),r.decode=e=>Te(e,r.codec())})(On||(On={}));var Kr;(function(r){let t;r.codec=()=>(t==null&&(t=Re((e,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),e.identityKey!=null&&e.identityKey.byteLength>0&&(n.uint32(10),n.bytes(e.identityKey)),e.identitySig!=null&&e.identitySig.byteLength>0&&(n.uint32(18),n.bytes(e.identitySig)),e.extensions!=null&&(n.uint32(34),On.codec().encode(e.extensions,n)),o.lengthDelimited!==!1&&n.ldelim()},(e,n)=>{let o={identityKey:dt(0),identitySig:dt(0)},s=n==null?e.len:e.pos+n;for(;e.pos<s;){let i=e.uint32();switch(i>>>3){case 1:{o.identityKey=e.bytes();break}case 2:{o.identitySig=e.bytes();break}case 4:{o.extensions=On.codec().decode(e,e.uint32());break}default:{e.skipType(i&7);break}}}return o})),t),r.encode=e=>Ue(e,r.codec()),r.decode=e=>Te(e,r.codec())})(Kr||(Kr={}));async function ti(r,t,e){let n=await r.sign(Hc(t));return Kr.encode({identityKey:Ze(r.publicKey),identitySig:n,extensions:e})}async function ei(r,t,e){try{let n=Kr.decode(r),o=Lr(n.identityKey);if(e?.equals(o)===!1)throw new Error(`Payload identity key ${o} does not match expected remote identity key ${e}`);if(!t)throw new Error("Remote static does not exist");let s=Hc(t);if(!await o.verify(s,n.identitySig))throw new Error("Invalid payload signature");return n}catch(n){throw new Vr(n.message)}}function Hc(r){let t=tt("noise-libp2p-static-key:");return r instanceof Uint8Array?Bt([t,r],t.length+r.length):(r.prepend(t),r)}async function qc(r,t){let{log:e,connection:n,crypto:o,privateKey:s,prologue:i,s:a,remoteIdentityKey:c,extensions:f}=r,u=await ti(s,a.publicKey,f),l=new Dr({crypto:o,protocolName:"Noise_XX_25519_ChaChaPoly_SHA256",initiator:!0,prologue:i,s:a});Zs(l.s,e),e.trace("Stage 0 - Initiator starting to send first message."),await n.write(l.writeMessageA(Ne),t),e.trace("Stage 0 - Initiator finished sending first message."),js(l.e,e),e.trace("Stage 1 - Initiator waiting to receive first message from responder...");let d=l.readMessageB(await n.read(t));e.trace("Stage 1 - Initiator received the message."),Xs(l.re,e),Mc(l.rs,e),e.trace("Initiator going to check remote's signature...");let g=await ei(d,l.rs,c);e.trace("All good with the signature!"),e.trace("Stage 2 - Initiator sending third handshake message."),await n.write(l.writeMessageC(u),t),e.trace("Stage 2 - Initiator sent message with signed payload.");let[w,m]=l.ss.split();return Ys(w,m,e),{payload:g,encrypt:h=>w.encryptWithAd(Ne,h),decrypt:(h,x)=>m.decryptWithAd(Ne,h,x)}}async function Vc(r,t){let{log:e,connection:n,crypto:o,privateKey:s,prologue:i,s:a,remoteIdentityKey:c,extensions:f}=r,u=await ti(s,a.publicKey,f),l=new Dr({crypto:o,protocolName:"Noise_XX_25519_ChaChaPoly_SHA256",initiator:!1,prologue:i,s:a});Zs(l.s,e),e.trace("Stage 0 - Responder waiting to receive first message."),l.readMessageA(await n.read(t)),e.trace("Stage 0 - Responder received first message."),Xs(l.re,e),e.trace("Stage 1 - Responder sending out first message with signed payload and static key."),await n.write(l.writeMessageB(u),t),e.trace("Stage 1 - Responder sent the second handshake message with signed payload."),js(l.e,e),e.trace("Stage 2 - Responder waiting for third handshake message...");let d=l.readMessageC(await n.read(t));e.trace("Stage 2 - Responder received the message, finished handshake.");let g=await ei(d,l.rs,c),[w,m]=l.ss.split();return Ys(w,m,e),{payload:g,encrypt:h=>m.encryptWithAd(Ne,h),decrypt:(h,x)=>w.decryptWithAd(Ne,h,x)}}var zc=16;function Gc(r,t){return async function*(e){for await(let n of e)for(let o=0;o<n.length;o+=65519){let s=o+65519;s>n.length&&(s=n.length);let i;n instanceof Uint8Array?i=r.encrypt(n.subarray(o,s)):i=r.encrypt(n.sublist(o,s)),t?.encryptedPackets.increment(),yield new Z(er(i.byteLength),i)}}}function Wc(r,t){return async function*(e){for await(let n of e)for(let o=0;o<n.length;o+=65535){let s=o+65535;if(s>n.length&&(s=n.length),s-zc<o)throw new Error("Invalid chunk");let i=n.sublist(o,s),a=n.subarray(o,s-zc);try{let c=r.decrypt(i,a);t?.decryptedPackets.increment(),yield c}catch(c){throw t?.decryptErrors.increment(),c}}}}var Mn=class{protocol="/noise";crypto;prologue;staticKey;extensions;metrics;components;constructor(t,e={}){let{staticNoiseKey:n,extensions:o,crypto:s,prologueBytes:i}=e,{metrics:a}=t;this.components=t;let c=s??Dc;this.crypto=Kc(c),this.extensions=o,this.metrics=a?Oc(a):void 0,n?this.staticKey=c.generateX25519KeyPairFromSeed(n):this.staticKey=c.generateX25519KeyPair(),this.prologue=i??dt(0)}[Symbol.toStringTag]="@chainsafe/libp2p-noise";[jr]=["@libp2p/connection-encryption","@chainsafe/libp2p-noise"];async secureOutbound(t,e){let n=Rs(t,{lengthEncoder:er,lengthDecoder:Nr,maxDataLength:65535}),o=await this.performHandshakeInitiator(n,this.components.privateKey,e?.remotePeer?.publicKey,e),s=await this.createSecureConnection(n,o);t.source=s.source,t.sink=s.sink;let i=Lr(o.payload.identityKey);return{conn:t,remoteExtensions:o.payload.extensions,remotePeer:Ls(i)}}async secureInbound(t,e){let n=Rs(t,{lengthEncoder:er,lengthDecoder:Nr,maxDataLength:65535}),o=await this.performHandshakeResponder(n,this.components.privateKey,e?.remotePeer?.publicKey,e),s=await this.createSecureConnection(n,o);t.source=s.source,t.sink=s.sink;let i=Lr(o.payload.identityKey);return{conn:t,remoteExtensions:o.payload.extensions,remotePeer:Ls(i)}}async performHandshakeInitiator(t,e,n,o){let s;try{s=await qc({connection:t,privateKey:e,remoteIdentityKey:n,log:this.components.logger.forComponent("libp2p:noise:xxhandshake"),crypto:this.crypto,prologue:this.prologue,s:this.staticKey,extensions:this.extensions},o),this.metrics?.xxHandshakeSuccesses.increment()}catch(i){throw this.metrics?.xxHandshakeErrors.increment(),i}return s}async performHandshakeResponder(t,e,n,o){let s;try{s=await Vc({connection:t,privateKey:e,remoteIdentityKey:n,log:this.components.logger.forComponent("libp2p:noise:xxhandshake"),crypto:this.crypto,prologue:this.prologue,s:this.staticKey,extensions:this.extensions},o),this.metrics?.xxHandshakeSuccesses.increment()}catch(i){throw this.metrics?.xxHandshakeErrors.increment(),i}return s}async createSecureConnection(t,e){let[n,o]=yc(),s=t.unwrap();return await wc(n,Gc(e,this.metrics),s,i=>kr(i,{lengthDecoder:Nr}),Wc(e,this.metrics),n),o}};function $c(r={}){return t=>new Mn(t,r)}var Hn=class{index=0;input="";new(t){return this.index=0,this.input=t,this}readAtomically(t){let e=this.index,n=t();return n===void 0&&(this.index=e),n}parseWith(t){let e=t();if(this.index===this.input.length)return e}peekChar(){if(!(this.index>=this.input.length))return this.input[this.index]}readChar(){if(!(this.index>=this.input.length))return this.input[this.index++]}readGivenChar(t){return this.readAtomically(()=>{let e=this.readChar();if(e===t)return e})}readSeparator(t,e,n){return this.readAtomically(()=>{if(!(e>0&&this.readGivenChar(t)===void 0))return n()})}readNumber(t,e,n,o){return this.readAtomically(()=>{let s=0,i=0,a=this.peekChar();if(a===void 0)return;let c=a==="0",f=2**(8*o)-1;for(;;){let u=this.readAtomically(()=>{let l=this.readChar();if(l===void 0)return;let d=Number.parseInt(l,t);if(!Number.isNaN(d))return d});if(u===void 0)break;if(s*=t,s+=u,s>f||(i+=1,e!==void 0&&i>e))return}if(i!==0)return!n&&c&&i>1?void 0:s})}readIPv4Addr(){return this.readAtomically(()=>{let t=new Uint8Array(4);for(let e=0;e<t.length;e++){let n=this.readSeparator(".",e,()=>this.readNumber(10,3,!1,1));if(n===void 0)return;t[e]=n}return t})}readIPv6Addr(){let t=e=>{for(let n=0;n<e.length/2;n++){let o=n*2;if(n<e.length-3){let i=this.readSeparator(":",n,()=>this.readIPv4Addr());if(i!==void 0)return e[o]=i[0],e[o+1]=i[1],e[o+2]=i[2],e[o+3]=i[3],[o+4,!0]}let s=this.readSeparator(":",n,()=>this.readNumber(16,4,!0,2));if(s===void 0)return[o,!1];e[o]=s>>8,e[o+1]=s&255}return[e.length,!1]};return this.readAtomically(()=>{let e=new Uint8Array(16),[n,o]=t(e);if(n===16)return e;if(o||this.readGivenChar(":")===void 0||this.readGivenChar(":")===void 0)return;let s=new Uint8Array(14),i=16-(n+2),[a]=t(s.subarray(0,i));return e.set(s.subarray(0,a),16-a),e})}readIPAddr(){return this.readIPv4Addr()??this.readIPv6Addr()}};var Zc=45,ed=15,or=new Hn;function ri(r){if(!(r.length>ed))return or.new(r).parseWith(()=>or.readIPv4Addr())}function ni(r){if(r.includes("%")&&(r=r.split("%")[0]),!(r.length>Zc))return or.new(r).parseWith(()=>or.readIPv6Addr())}function qn(r,t=!1){if(r.includes("%")&&(r=r.split("%")[0]),r.length>Zc)return;let e=or.new(r).parseWith(()=>or.readIPAddr());if(e)return t&&e.length===4?Uint8Array.from([0,0,0,0,0,0,0,0,0,0,255,255,e[0],e[1],e[2],e[3]]):e}function Vn(r){return!!ri(r)}function Fn(r){return!!ni(r)}function zn(r){return!!qn(r)}var rd=r=>r.toString().split("/").slice(1),sr=r=>({match:t=>t.length<1?!1:r(t[0])?t.slice(1):!1,pattern:"fn"}),G=r=>({match:t=>sr(e=>e===r).match(t),pattern:r}),De=()=>({match:r=>sr(t=>typeof t=="string").match(r),pattern:"{string}"}),Mr=()=>({match:r=>sr(t=>!isNaN(parseInt(t))).match(r),pattern:"{number}"}),Q=()=>({match:r=>{if(r.length<2||r[0]!=="p2p"&&r[0]!=="ipfs")return!1;if(r[1].startsWith("Q")||r[1].startsWith("1"))try{et.decode(`z${r[1]}`)}catch{return!1}else return!1;return r.slice(2)},pattern:"/p2p/{peerid}"}),Hr=()=>({match:r=>{if(r.length<2||r[0]!=="certhash")return!1;try{Jo.decode(r[1])}catch{return!1}return r.slice(2)},pattern:"/certhash/{certhash}"}),X=r=>({match:t=>{let e=r.match(t);return e===!1?t:e},pattern:`optional(${r.pattern})`}),Tt=(...r)=>({match:t=>{let e;for(let n of r){let o=n.match(t);o!==!1&&(e==null||o.length<e.length)&&(e=o)}return e??!1},pattern:`or(${r.map(t=>t.pattern).join(", ")})`}),W=(...r)=>({match:t=>{for(let e of r){let n=e.match(t);if(n===!1)return!1;t=n}return t},pattern:`and(${r.map(t=>t.pattern).join(", ")})`});function ct(...r){function t(o){let s=rd(o);for(let i of r){let a=i.match(s);if(a===!1)return!1;s=a}return s}function e(o){return t(o)!==!1}function n(o){let s=t(o);return s===!1?!1:s.length===0}return{matchers:r,matches:e,exactMatch:n}}var Wn=W(G("dns4"),De()),$n=W(G("dns6"),De()),Zn=W(G("dnsaddr"),De()),si=W(G("dns"),De()),db=ct(Wn,X(Q())),pb=ct($n,X(Q())),mb=ct(Zn,X(Q())),yb=ct(Tt(si,Zn,Wn,$n),X(Q())),jc=W(G("ip4"),sr(Vn)),Xc=W(G("ip6"),sr(Fn)),ii=Tt(jc,Xc),ae=Tt(ii,si,Wn,$n,Zn),gb=ct(Tt(ii,W(Tt(si,Zn,Wn,$n),X(Q())))),wb=ct(jc),xb=ct(Xc),bb=ct(ii),ai=W(ae,G("tcp"),Mr()),qr=W(ae,G("udp"),Mr()),Eb=ct(W(ai,X(Q()))),Sb=ct(qr),ci=W(qr,G("quic"),X(Q())),jn=W(qr,G("quic-v1"),X(Q())),nd=Tt(ci,jn),Ab=ct(ci),vb=ct(jn),oi=Tt(ae,ai,qr,ci,jn),Yc=Tt(W(oi,G("ws"),X(Q()))),Bb=ct(Yc),Jc=Tt(W(oi,G("wss"),X(Q())),W(oi,G("tls"),X(W(G("sni"),De())),G("ws"),X(Q()))),Ib=ct(Jc),Qc=W(qr,G("webrtc-direct"),X(Hr()),X(Hr()),X(Q())),Lb=ct(Qc),tu=W(jn,G("webtransport"),X(Hr()),X(Hr()),X(Q())),Xn=ct(tu),Gn=Tt(Yc,Jc,W(ai,X(Q())),W(nd,X(Q())),W(ae,X(Q())),Qc,tu,Q()),Tb=ct(Gn),od=W(Gn,G("p2p-circuit"),Q()),_b=ct(od),sd=Tt(W(Gn,G("p2p-circuit"),G("webrtc"),X(Q())),W(Gn,G("webrtc"),X(Q())),W(G("webrtc"),X(Q()))),Cb=ct(sd),id=Tt(W(ae,G("tcp"),Mr(),G("http"),X(Q())),W(ae,G("http"),X(Q()))),Ub=ct(id),ad=Tt(W(ae,G("tcp"),Tt(W(G("443"),G("http")),W(Mr(),G("https"))),X(Q())),W(ae,G("tls"),G("http"),X(Q())),W(ae,G("https"),X(Q()))),Rb=ct(ad),cd=Tt(W(G("memory"),De(),X(Q()))),Pb=ct(cd);var Ke=class extends Event{type;detail;constructor(t,e){super(t),this.type=t,this.detail=e}};function ui(r){throw new Error("Not implemented")}function eu(r){if(r!=null){if(typeof r[Symbol.iterator]=="function")return r[Symbol.iterator]();if(typeof r[Symbol.asyncIterator]=="function")return r[Symbol.asyncIterator]();if(typeof r.next=="function")return r}throw new Error("argument is not an iterator or iterable")}function ru(r){return r==null?!1:typeof r.then=="function"&&typeof r.catch=="function"&&typeof r.finally=="function"}function nu(r,t){let e=eu(r).return?.();ru(e)&&e.catch(n=>{t.error("could not cause iterator to return",n)})}var ud=5e3;function fi(r){return r==null?!1:typeof r.then=="function"&&typeof r.catch=="function"&&typeof r.finally=="function"}var Yn=class{id;direction;timeline;protocol;metadata;source;status;readStatus;writeStatus;log;sinkController;sinkEnd;closed;endErr;streamSource;onEnd;onCloseRead;onCloseWrite;onReset;onAbort;sendCloseWriteTimeout;sendingData;constructor(t){this.sinkController=new AbortController,this.sinkEnd=It(),this.closed=It(),this.log=t.log,this.status="open",this.readStatus="ready",this.writeStatus="ready",this.id=t.id,this.metadata=t.metadata??{},this.direction=t.direction,this.timeline={open:Date.now()},this.sendCloseWriteTimeout=t.sendCloseWriteTimeout??ud,this.onEnd=t.onEnd,this.onCloseRead=t?.onCloseRead,this.onCloseWrite=t?.onCloseWrite,this.onReset=t?.onReset,this.onAbort=t?.onAbort,this.source=this.streamSource=Qe({onEnd:e=>{e!=null?this.log.trace("source ended with error",e):this.log.trace("source ended"),this.onSourceEnd(e)}}),this.sink=this.sink.bind(this)}async sink(t){if(this.writeStatus!=="ready")throw new Gr(`writable end state is "${this.writeStatus}" not "ready"`);try{this.writeStatus="writing";let e={signal:this.sinkController.signal};if(this.direction==="outbound"){let o=this.sendNewStream(e);fi(o)&&await o}let n=()=>{nu(t,this.log)};try{this.sinkController.signal.addEventListener("abort",n),this.log.trace("sink reading from source");for await(let o of t){o=o instanceof Uint8Array?new Z(o):o;let s=this.sendData(o,e);fi(s)&&(this.sendingData=It(),await s,this.sendingData.resolve(),this.sendingData=void 0)}}finally{this.sinkController.signal.removeEventListener("abort",n)}this.log.trace('sink finished reading from source, write status is "%s"',this.writeStatus),this.writeStatus==="writing"&&(this.writeStatus="closing",this.log.trace("send close write to remote"),await this.sendCloseWrite({signal:AbortSignal.timeout(this.sendCloseWriteTimeout)}),this.writeStatus="closed"),this.onSinkEnd()}catch(e){throw this.log.trace("sink ended with error, calling abort with error",e),this.abort(e),e}finally{this.log.trace("resolve sink end"),this.sinkEnd.resolve()}}onSourceEnd(t){this.timeline.closeRead==null&&(this.timeline.closeRead=Date.now(),this.readStatus="closed",t!=null&&this.endErr==null&&(this.endErr=t),this.onCloseRead?.(),this.timeline.closeWrite!=null?(this.log.trace("source and sink ended"),this.timeline.close=Date.now(),this.status!=="aborted"&&this.status!=="reset"&&(this.status="closed"),this.onEnd!=null&&this.onEnd(this.endErr),this.closed.resolve()):this.log.trace("source ended, waiting for sink to end"))}onSinkEnd(t){this.timeline.closeWrite==null&&(this.timeline.closeWrite=Date.now(),this.writeStatus="closed",t!=null&&this.endErr==null&&(this.endErr=t),this.onCloseWrite?.(),this.timeline.closeRead!=null?(this.log.trace("sink and source ended"),this.timeline.close=Date.now(),this.status!=="aborted"&&this.status!=="reset"&&(this.status="closed"),this.onEnd!=null&&this.onEnd(this.endErr),this.closed.resolve()):this.log.trace("sink ended, waiting for source to end"))}async close(t){this.status==="open"&&(this.log.trace("closing gracefully"),this.status="closing",await Ct(Promise.all([this.closeWrite(t),this.closeRead(t),this.closed.promise]),t?.signal),this.status="closed",this.log.trace("closed gracefully"))}async closeRead(t={}){if(this.readStatus==="closing"||this.readStatus==="closed")return;this.log.trace('closing readable end of stream with starting read status "%s"',this.readStatus);let e=this.readStatus;this.readStatus="closing",this.status!=="reset"&&this.status!=="aborted"&&this.timeline.closeRead==null&&(this.log.trace("send close read to remote"),await this.sendCloseRead(t)),e==="ready"&&(this.log.trace("ending internal source queue with %d queued bytes",this.streamSource.readableLength),this.streamSource.end()),this.log.trace("closed readable end of stream")}async closeWrite(t={}){this.writeStatus==="closing"||this.writeStatus==="closed"||(this.log.trace('closing writable end of stream with starting write status "%s"',this.writeStatus),this.writeStatus==="ready"&&(this.log.trace("sink was never sunk, sink an empty array"),await Ct(this.sink([]),t.signal)),this.writeStatus==="writing"&&(this.sendingData!=null&&await Ct(this.sendingData.promise,t.signal),this.log.trace("aborting source passed to .sink"),this.sinkController.abort(),await Ct(this.sinkEnd.promise,t.signal)),this.writeStatus="closed",this.log.trace("closed writable end of stream"))}abort(t){if(this.status==="closed"||this.status==="aborted"||this.status==="reset")return;this.log("abort with error",t),this.log("try to send reset to remote");let e=this.sendReset();fi(e)&&e.catch(n=>{this.log.error("error sending reset message",n)}),this.status="aborted",this.timeline.abort=Date.now(),this._closeSinkAndSource(t),this.onAbort?.(t)}reset(){if(this.status==="closed"||this.status==="aborted"||this.status==="reset")return;let t=new zr("stream reset");this.status="reset",this.timeline.reset=Date.now(),this._closeSinkAndSource(t),this.onReset?.()}_closeSinkAndSource(t){this._closeSink(t),this._closeSource(t)}_closeSink(t){this.writeStatus==="writing"&&(this.log.trace("end sink source"),this.sinkController.abort()),this.onSinkEnd(t)}_closeSource(t){this.readStatus!=="closing"&&this.readStatus!=="closed"&&(this.log.trace("ending source with %d bytes to be read by consumer",this.streamSource.readableLength),this.readStatus="closing",this.streamSource.end(t))}remoteCloseWrite(){if(this.readStatus==="closing"||this.readStatus==="closed"){this.log("received remote close write but local source is already closed");return}this.log.trace("remote close write"),this._closeSource()}remoteCloseRead(){if(this.writeStatus==="closing"||this.writeStatus==="closed"){this.log("received remote close read but local sink is already closed");return}this.log.trace("remote close read"),this._closeSink()}destroy(){if(this.status==="closed"||this.status==="aborted"||this.status==="reset"){this.log("received destroy but we are already closed");return}this.log.trace("stream destroyed"),this._closeSinkAndSource()}sourcePush(t){this.streamSource.push(t)}sourceReadableLength(){return this.streamSource.readableLength}};var li=class extends Yn{writer;reader;constructor(t){super(t),this.writer=t.bidiStream.writable.getWriter(),this.reader=t.bidiStream.readable.getReader(),Promise.resolve().then(async()=>{for(;;){let e=await this.reader.read();if(e.done){t.log("remote closed write");return}e.value!=null&&this.sourcePush(new Z(e.value))}}).catch(e=>{t.log.error("error reading from stream",e),this.abort(e)}).finally(()=>{this.remoteCloseWrite()}),this.writer.closed.then(()=>{t.log("writer closed")}).catch(e=>{t.log("writer close promise rejected",e)}).finally(()=>{this.remoteCloseRead()})}sendNewStream(t){}async sendData(t,e){for await(let n of t)this.log("sendData waiting for writer to be ready"),await Ct(this.writer.ready,e?.signal),this.writer.write(n).catch(o=>{this.log.error("error sending stream data",o)})}async sendReset(t){this.log("sendReset aborting writer"),await Ct(this.writer.abort(),t?.signal),this.log("sendReset aborted writer")}async sendCloseWrite(t){this.log("sendCloseWrite closing writer"),await Ct(this.writer.close(),t?.signal),this.log("sendCloseWrite closed writer")}async sendCloseRead(t){this.log("sendCloseRead cancelling reader"),await Ct(this.reader.cancel(),t?.signal),this.log("sendCloseRead cancelled reader")}};async function hi(r,t,e,n,o,s){let i=s.forComponent(`libp2p:webtransport:stream:${e}:${t}`),a=new li({bidiStream:r,id:t,direction:e,log:i,onEnd:()=>{let c=n.findIndex(f=>f===a);c!==-1&&n.splice(c,1),o?.(a)}});return a}function Jn(){return{source:{[Symbol.asyncIterator](){return{async next(){return new Promise(()=>{})}}}},sink:async r=>new Promise(()=>{})}}function ou(r,t,e,n){let o=0,s=e.forComponent("libp2p:webtransport:muxer");return{protocol:"webtransport",createStreamMuxer:i=>{typeof i=="function"&&(i={onIncomingStream:i});let a=[];Promise.resolve().then(async()=>{for(;;){let{done:f,value:u}=await t.read();if(f)break;if(a.length>=n.maxInboundStreams)s(`too many inbound streams open - ${a.length}/${n.maxInboundStreams}, closing new incoming stream`),u.writable.close().catch(l=>{s.error(`failed to close inbound stream that crossed our maxInboundStream limit: ${l.message}`)}),u.readable.cancel().catch(l=>{s.error(`failed to close inbound stream that crossed our maxInboundStream limit: ${l.message}`)});else{let l=await hi(u,String(o++),"inbound",a,i?.onStreamEnd,e);a.push(l),i?.onIncomingStream?.(l)}}}).catch(f=>{s.error("could not create a new stream",f)});let c={protocol:"webtransport",streams:a,newStream:async f=>{s("new outgoing stream",f);let u=await r.createBidirectionalStream(),l=await hi(u,String(o++),i?.direction??"outbound",a,i?.onStreamEnd,e);return a.push(l),l},close:async()=>{s("closing webtransport muxer gracefully");try{r.close()}catch(f){c.abort(f)}},abort:f=>{s("closing webtransport muxer with err:",f);try{r.close()}catch(u){s.error("webtransport session threw error during close",u)}},...Jn()};return c}}}function su(r,t){return t.filter(n=>!!r.find(o=>wt(n,o))).length===t.length}var h1=parseInt("0xFFFF",16),d1=new Uint8Array([0,0,0,0,0,0,0,0,0,0,255,255]);var cu=Vn,pd=Fn,di=function(r){let t=0;if(r=r.toString().trim(),cu(r)){let e=new Uint8Array(t+4);return r.split(/\./g).forEach(n=>{e[t++]=parseInt(n,10)&255}),e}if(pd(r)){let e=r.split(":",8),n;for(n=0;n<e.length;n++){let s=cu(e[n]),i;s&&(i=di(e[n]),e[n]=F(i.slice(0,2),"base16")),i!=null&&++n<8&&e.splice(n,0,F(i.slice(2,4),"base16"))}if(e[0]==="")for(;e.length<8;)e.unshift("0");else if(e[e.length-1]==="")for(;e.length<8;)e.push("0");else if(e.length<8){for(n=0;n<e.length&&e[n]!=="";n++);let s=[n,1];for(n=9-e.length;n>0;n--)s.push("0");e.splice.apply(e,s)}let o=new Uint8Array(t+16);for(n=0;n<e.length;n++){let s=parseInt(e[n],16);o[t++]=s>>8&255,o[t++]=s&255}return o}throw new Error("invalid ip address")},uu=function(r,t=0,e){t=~~t,e=e??r.length-t;let n=new DataView(r.buffer);if(e===4){let o=[];for(let s=0;s<e;s++)o.push(r[t+s]);return o.join(".")}if(e===16){let o=[];for(let s=0;s<e;s+=2)o.push(n.getUint16(t+s).toString(16));return o.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""};var ir={},pi={},yd=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,-1,"ip6zone"],[43,8,"ipcidr"],[53,-1,"dns",!0],[54,-1,"dns4",!0],[55,-1,"dns6",!0],[56,-1,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc-direct"],[281,0,"webrtc"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,-1,"unix",!1,!0],[421,-1,"ipfs"],[421,-1,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,-1,"garlic64"],[448,0,"tls"],[449,-1,"sni"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,-1,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[481,-1,"http-path"],[777,-1,"memory"]];yd.forEach(r=>{let t=gd(...r);pi[t.code]=t,ir[t.name]=t});function gd(r,t,e,n,o){return{code:r,size:t,name:e,resolvable:!!n,path:!!o}}function J(r){if(typeof r=="number"){if(pi[r]!=null)return pi[r];throw new Error(`no protocol with code: ${r}`)}else if(typeof r=="string"){if(ir[r]!=null)return ir[r];throw new Error(`no protocol with name: ${r}`)}throw new Error(`invalid protocol id type: ${typeof r}`)}var Z1=J("ip4"),j1=J("ip6"),X1=J("ipcidr");function wi(r,t){switch(J(r).code){case 4:case 41:return xd(t);case 42:return gi(t);case 43:return F(t,"base10");case 6:case 273:case 33:case 132:return hu(t).toString();case 53:case 54:case 55:case 56:case 400:case 449:case 777:return gi(t);case 421:return Ad(t);case 444:return lu(t);case 445:return lu(t);case 466:return Sd(t);case 481:return globalThis.encodeURIComponent(gi(t));default:return F(t,"base16")}}function xi(r,t){switch(J(r).code){case 4:return fu(t);case 41:return fu(t);case 42:return yi(t);case 43:return tt(t,"base10");case 6:case 273:case 33:case 132:return bi(parseInt(t,10));case 53:case 54:case 55:case 56:case 400:case 449:case 777:return yi(t);case 421:return bd(t);case 444:return vd(t);case 445:return Bd(t);case 466:return Ed(t);case 481:return yi(globalThis.decodeURIComponent(t));default:return tt(t,"base16")}}var mi=Object.values(_e).map(r=>r.decoder),wd=function(){let r=mi[0].or(mi[1]);return mi.slice(2).forEach(t=>r=r.or(t)),r}();function fu(r){if(!zn(r))throw new Error("invalid ip address");return di(r)}function xd(r){let t=uu(r,0,r.length);if(t==null)throw new Error("ipBuff is required");if(!zn(t))throw new Error("invalid ip address");return t}function bi(r){let t=new ArrayBuffer(2);return new DataView(t).setUint16(0,r),new Uint8Array(t)}function hu(r){return new DataView(r.buffer).getUint16(r.byteOffset)}function yi(r){let t=tt(r),e=Uint8Array.from(Gt(t.length));return Bt([e,t],e.length+t.length)}function gi(r){let t=qt(r);if(r=r.slice(ft(t)),r.length!==t)throw new Error("inconsistent lengths");return F(r)}function bd(r){let t;r[0]==="Q"||r[0]==="1"?t=ue(et.decode(`z${r}`)).bytes:t=lt.parse(r).multihash.bytes;let e=Uint8Array.from(Gt(t.length));return Bt([e,t],e.length+t.length)}function Ed(r){let t=wd.decode(r),e=Uint8Array.from(Gt(t.length));return Bt([e,t],e.length+t.length)}function Sd(r){let t=qt(r),e=r.slice(ft(t));if(e.length!==t)throw new Error("inconsistent lengths");return"u"+F(e,"base64url")}function Ad(r){let t=qt(r),e=r.slice(ft(t));if(e.length!==t)throw new Error("inconsistent lengths");return F(e,"base58btc")}function vd(r){let t=r.split(":");if(t.length!==2)throw new Error(`failed to parse onion addr: ["'${t.join('", "')}'"]' does not contain a port number`);if(t[0].length!==16)throw new Error(`failed to parse onion addr: ${t[0]} not a Tor onion address.`);let e=Xt.decode("b"+t[0]),n=parseInt(t[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");let o=bi(n);return Bt([e,o],e.length+o.length)}function Bd(r){let t=r.split(":");if(t.length!==2)throw new Error(`failed to parse onion addr: ["'${t.join('", "')}'"]' does not contain a port number`);if(t[0].length!==56)throw new Error(`failed to parse onion addr: ${t[0]} not a Tor onion3 address.`);let e=Xt.decode(`b${t[0]}`),n=parseInt(t[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");let o=bi(n);return Bt([e,o],e.length+o.length)}function lu(r){let t=r.slice(0,r.length-2),e=r.slice(r.length-2),n=F(t,"base32"),o=hu(e);return`${n}:${o}`}function du(r){r=Ei(r);let t=[],e=[],n=null,o=r.split("/").slice(1);if(o.length===1&&o[0]==="")return{bytes:new Uint8Array,string:"/",tuples:[],stringTuples:[],path:null};for(let s=0;s<o.length;s++){let i=o[s],a=J(i);if(a.size===0){t.push([a.code]),e.push([a.code]);continue}if(s++,s>=o.length)throw new Qn("invalid address: "+r);if(a.path===!0){n=Ei(o.slice(s).join("/")),t.push([a.code,xi(a.code,n)]),e.push([a.code,n]);break}let c=xi(a.code,o[s]);t.push([a.code,c]),e.push([a.code,wi(a.code,c)])}return{string:pu(e),bytes:to(t),tuples:t,stringTuples:e,path:n}}function Si(r){let t=[],e=[],n=null,o=0;for(;o<r.length;){let s=qt(r,o),i=ft(s),a=J(s),c=Id(a,r.slice(o+i));if(c===0){t.push([s]),e.push([s]),o+=i;continue}let f=r.slice(o+i,o+i+c);if(o+=c+i,o>r.length)throw new Qn("Invalid address Uint8Array: "+F(r,"base16"));t.push([s,f]);let u=wi(s,f);if(e.push([s,u]),a.path===!0){n=u;break}}return{bytes:Uint8Array.from(r),string:pu(e),tuples:t,stringTuples:e,path:n}}function pu(r){let t=[];return r.map(e=>{let n=J(e[0]);return t.push(n.name),e.length>1&&e[1]!=null&&t.push(e[1]),null}),Ei(t.join("/"))}function to(r){return Bt(r.map(t=>{let e=J(t[0]),n=Uint8Array.from(Gt(e.code));return t.length>1&&t[1]!=null&&(n=Bt([n,t[1]])),n}))}function Id(r,t){if(r.size>0)return r.size/8;if(r.size===0)return 0;{let e=qt(t instanceof Uint8Array?t:Uint8Array.from(t));return e+ft(e)}}function Ei(r){return"/"+r.trim().split("/").filter(t=>t).join("/")}var Qn=class extends Error{static name="ParseError";name="ParseError";constructor(t){super(`Error parsing address: ${t}`)}};var Ld=Symbol.for("nodejs.util.inspect.custom"),vi=Symbol.for("@multiformats/js-multiaddr/multiaddr"),Td=[J("dns").code,J("dns4").code,J("dns6").code,J("dnsaddr").code],Ai=class extends Error{constructor(t="No available resolver"){super(t),this.name="NoAvailableResolverError"}},eo=class r{bytes;#e;#t;#r;#n;[vi]=!0;constructor(t){t==null&&(t="");let e;if(t instanceof Uint8Array)e=Si(t);else if(typeof t=="string"){if(t.length>0&&t.charAt(0)!=="/")throw new Error(`multiaddr "${t}" must start with a "/"`);e=du(t)}else if(yu(t))e=Si(t.bytes);else throw new Error("addr must be a string, Buffer, or another Multiaddr");this.bytes=e.bytes,this.#e=e.string,this.#t=e.tuples,this.#r=e.stringTuples,this.#n=e.path}toString(){return this.#e}toJSON(){return this.toString()}toOptions(){let t,e,n,o,s="",i=J("tcp"),a=J("udp"),c=J("ip4"),f=J("ip6"),u=J("dns6"),l=J("ip6zone");for(let[g,w]of this.stringTuples())g===l.code&&(s=`%${w??""}`),Td.includes(g)&&(e=i.name==="tcp"?"tcp":"udp",o=443,n=`${w??""}${s}`,t=g===u.code?6:4),(g===i.code||g===a.code)&&(e=J(g).name==="tcp"?"tcp":"udp",o=parseInt(w??"")),(g===c.code||g===f.code)&&(e=J(g).name==="tcp"?"tcp":"udp",n=`${w??""}${s}`,t=g===f.code?6:4);if(t==null||e==null||n==null||o==null)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:t,host:n,transport:e,port:o}}protos(){return this.#t.map(([t])=>Object.assign({},J(t)))}protoCodes(){return this.#t.map(([t])=>t)}protoNames(){return this.#t.map(([t])=>J(t).name)}tuples(){return this.#t.map(([t,e])=>e==null?[t]:[t,e])}stringTuples(){return this.#r.map(([t,e])=>e==null?[t]:[t,e])}encapsulate(t){return t=new r(t),new r(this.toString()+t.toString())}decapsulate(t){let e=t.toString(),n=this.toString(),o=n.lastIndexOf(e);if(o<0)throw new Error(`Address ${this.toString()} does not contain subaddress: ${t.toString()}`);return new r(n.slice(0,o))}decapsulateCode(t){let e=this.tuples();for(let n=e.length-1;n>=0;n--)if(e[n][0]===t)return new r(to(e.slice(0,n)));return this}getPeerId(){try{let t=[];this.stringTuples().forEach(([n,o])=>{n===ir.p2p.code&&t.push([n,o]),n===ir["p2p-circuit"].code&&(t=[])});let e=t.pop();if(e?.[1]!=null){let n=e[1];return n[0]==="Q"||n[0]==="1"?F(et.decode(`z${n}`),"base58btc"):F(lt.parse(n).multihash.bytes,"base58btc")}return null}catch{return null}}getPath(){return this.#n}equals(t){return wt(this.bytes,t.bytes)}async resolve(t){let e=this.protos().find(s=>s.resolvable);if(e==null)return[this];let n=mu.get(e.name);if(n==null)throw new Ai(`no available resolver for ${e.name}`);return(await n(this,t)).map(s=>Bi(s))}nodeAddress(){let t=this.toOptions();if(t.transport!=="tcp"&&t.transport!=="udp")throw new Error(`multiaddr must have a valid format - no protocol with name: "${t.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:t.family,address:t.host,port:t.port}}isThinWaistAddress(t){let e=(t??this).protos();return!(e.length!==2||e[0].code!==4&&e[0].code!==41||e[1].code!==6&&e[1].code!==273)}[Ld](){return`Multiaddr(${this.#e})`}};var mu=new Map;function yu(r){return!!r?.[vi]}function Bi(r){return new eo(r)}var _d=Object.values(_e).map(r=>r.decoder).reduce((r,t)=>r.or(t));function Cd(r){return zt.decode(_d.decode(r))}function Ii(r){if(!Xn.matches(r))throw new Wr("Invalid multiaddr, was not a WebTransport address");let t=r.stringTuples(),e=t.filter(([i,a])=>i===J("certhash").code).map(([i,a])=>Cd(a??"")),n=t.filter(([i,a])=>i===J("p2p").code).map(([i,a])=>lc(a??""))[0],o=r.toOptions(),s=o.host;return o.family===6&&s?.includes(":")&&(s=`[${s}]`),{url:`https://${s}:${o.port}`,certhashes:e,remotePeer:n}}var gu=globalThis.WebTransport;var Li=class{log;components;config;metrics;constructor(t,e={}){this.log=t.logger.forComponent("libp2p:webtransport"),this.components=t,this.config={...e,maxInboundStreams:e.maxInboundStreams??1e3,certificates:e.certificates??[]},t.metrics!=null&&(this.metrics={dialerEvents:t.metrics.registerCounterGroup("libp2p_webtransport_dialer_events_total",{label:"event",help:"Total count of WebTransport dialer events by type"})})}[Symbol.toStringTag]="@libp2p/webtransport";[Di]=!0;[jr]=["@libp2p/transport"];async dial(t,e){e.signal.throwIfAborted(),this.log("dialing %s",t),e=e??{};let{url:n,certhashes:o,remotePeer:s}=Ii(t),i,a,c=()=>{},f=!1,u=!1,l=!1;try{this.metrics?.dialerEvents.increment({pending:!0});let d=new gu(`${n}/.well-known/libp2p-webtransport?type=noise`,{serverCertificateHashes:o.map(g=>({algorithm:"sha-256",value:g.digest}))});if(c=g=>{if(!f)try{this.metrics?.dialerEvents.increment({[g]:!0}),d.close()}catch(w){this.log.error("error closing wt session",w)}finally{a!=null&&(a.timeline.close=Date.now()),f=!0}},i=()=>{c(u?"noise_timeout":"ready_timeout")},e.signal.addEventListener("abort",i,{once:!0}),this.log("wait for session to be ready"),e.onProgress?.(new Ke("webtransport:wait-for-session")),await Promise.race([d.closed,d.ready]),this.log("session became ready"),u=!0,this.metrics?.dialerEvents.increment({ready:!0}),d.closed.catch(g=>{this.log.error("error on remote wt session close",g)}).finally(()=>{c("remote_close")}),l=await Ct(this.authenticateWebTransport({wt:d,remotePeer:s,certhashes:o,...e}),e.signal),!l)throw new Fr("Failed to authenticate webtransport");return this.metrics?.dialerEvents.increment({open:!0}),a={close:async()=>{this.log("closing webtransport"),c("close")},abort:g=>{this.log("aborting webtransport due to passed err",g),c("abort")},remoteAddr:t,timeline:{open:Date.now()},log:this.components.logger.forComponent("libp2p:webtransport:maconn"),...Jn()},await e.upgrader.upgradeOutbound(a,{...e,skipEncryption:!0,muxerFactory:ou(d,d.incomingBidirectionalStreams.getReader(),this.components.logger,this.config),skipProtection:!0})}catch(d){throw this.log.error("caught wt session err",d),c(l?"upgrade_error":u?"noise_error":"ready_error"),d}finally{i!=null&&e.signal?.removeEventListener("abort",i)}}async authenticateWebTransport({wt:t,remotePeer:e,certhashes:n,onProgress:o,signal:s}){s?.throwIfAborted(),o?.(new Ke("webtransport:open-authentication-stream"));let i=await t.createBidirectionalStream(),a=i.writable.getWriter(),c=i.readable.getReader(),f={source:async function*(){for(;;){let d=await c.read();if(d.value!=null&&(yield d.value),d.done)break}}(),sink:async d=>{for await(let g of d){await Ct(a.ready,s);let w=g instanceof Uint8Array?g:g.subarray();a.write(w).catch(m=>{this.log.error("could not write chunk during authentication of WebTransport stream",m)})}}},u=$c()(this.components);o?.(new Ke("webtransport:secure-outbound-connection"));let{remoteExtensions:l}=await u.secureOutbound(f,{signal:s,remotePeer:e});if(o?.(new Ke("webtransport:close-authentication-stream")),a.close().catch(d=>{this.log.error(`Failed to close authentication stream writer: ${d.message}`)}),c.cancel().catch(d=>{this.log.error(`Failed to close authentication stream reader: ${d.message}`)}),!su(l?.webtransportCerthashes??[],n.map(d=>d.bytes)))throw new yt("Our certhashes are not a subset of the remote's reported certhashes");return!0}createListener(t){return ui(this.components,{...t,certificates:this.config.certificates,maxInboundStreams:this.config.maxInboundStreams})}listenFilter(){return[]}dialFilter(t){return globalThis.WebTransport==null?[]:t.filter(e=>{if(!Xn.exactMatch(e))return!1;let{url:n,certhashes:o}=Ii(e);return n!=null&&o.length>0})}};function Ud(r={}){return t=>new Li(t,r)}return Cu(Rd);})();
//! TODO unclear how to add backpressure here?
/*! Bundled license information:

@noble/hashes/esm/utils.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/utils.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/modular.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/curve.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/edwards.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/montgomery.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/ed25519.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/weierstrass.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/_shortw_utils.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/secp256k1.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/ciphers/esm/utils.js:
  (*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) *)
*/
return Libp2PWebtransport}));
